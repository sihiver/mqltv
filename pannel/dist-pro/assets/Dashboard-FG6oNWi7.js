var D=(N,v,s)=>new Promise((w,m)=>{var x=n=>{try{h(s.next(n))}catch(u){m(u)}},g=n=>{try{h(s.throw(n))}catch(u){m(u)}},h=n=>n.done?w(n.value):Promise.resolve(n.value).then(x,g);h((s=s.apply(N,v)).next())});import{_ as Q}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C2ZlXlGE.js";import{I as c,r as I,_ as X}from"./index-edGwmMvL.js";/* empty css               *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css               */import{i as Y,L as q}from"./echarts-Bx5A8eFf.js";import{l as F,m as d,n as y,p as f,q as z,r as b,s as U}from"./element-plus-B47XQz09.js";import{j as Z,r as p,e as ee,x as ae,ac as te,C as B,l as T,D as t,G as a,u as e,t as _,L as j,_ as L,I as le}from"./vue-chunks-B2QQ4E8c.js";const oe={style:{display:"flex","align-items":"center",gap:"8px"}},se={style:{display:"flex","align-items":"center",gap:"8px"}},ne={style:{display:"flex","align-items":"center",gap:"8px"}},re=20,ie=Z({__name:"Dashboard",setup(N){const v=p({total_playlists:0,total_channels:0,active_channels:0,total_relays:0}),s=p({downloadMbps:0,uploadMbps:0,totalDownloadMB:0,totalUploadMB:0});let w=0,m=0,x=Date.now();const g=p([]),h=p([]),n=p([]);let u=null;const M=p([]),C=p([]),S=p(!1),O=p(!1),V=()=>D(this,null,function*(){try{const l=yield I.get({url:"/api/stats"});l&&l.data&&(v.value=l.data)}catch(l){console.error("Error loading stats:",l),v.value={total_playlists:0,total_channels:0,active_channels:0,total_relays:0}}}),k=()=>D(this,null,function*(){try{const l=yield I.get({url:"/api/streams/status"});if(l&&l.data){const o=l.data.total_bytes_read||0,i=l.data.total_bytes_write||0,r=Date.now();if(w===0&&m===0){w=o,m=i,x=r;return}const E=(r-x)/1e3,$=E>0?(o-w)*8/1024/1024/E:0,G=E>0?(i-m)*8/1024/1024/E:0;s.value={downloadMbps:$.toFixed(2),uploadMbps:G.toFixed(2),totalDownloadMB:(o/1024/1024).toFixed(2),totalUploadMB:(i/1024/1024).toFixed(2)};const K=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});g.value.push(K),h.value.push(parseFloat($.toFixed(2))),n.value.push(parseFloat(G.toFixed(2))),g.value.length>re&&(g.value.shift(),h.value.shift(),n.value.shift()),P(),w=o,m=i,x=r}}catch(l){console.error("Error loading bandwidth:",l),s.value={downloadMbps:0,uploadMbps:0,totalDownloadMB:0,totalUploadMB:0}}}),H=()=>D(this,null,function*(){S.value=!0;try{const l=yield I.get({url:"/api/recently-watched"});l&&l.data?(M.value=Array.isArray(l.data)?l.data:[],M.value):M.value=[]}catch(l){console.error("Error loading recently watched channels:",l),M.value=[]}finally{S.value=!1}}),W=()=>D(this,null,function*(){try{const l=yield I.get({url:"/api/active-channels"});l&&Array.isArray(l.data)?(C.value=l.data,C.value):C.value=[]}catch(l){console.error("Error loading active channels:",l),C.value=[]}}),J=()=>{const l=document.getElementById("bandwidthChart");l&&(u=Y(l),P())},P=()=>{if(!u)return;const l={title:{text:"Real-time Bandwidth",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:o=>{let i=o[0].name+"<br/>";return o.forEach(r=>{i+=`${r.marker} ${r.seriesName}: ${r.value} Mbps<br/>`}),i}},legend:{data:["Download","Upload"],top:30},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:g.value,axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:"Mbps",axisLabel:{formatter:"{value}"}},series:[{name:"Download",type:"line",smooth:!0,data:h.value,itemStyle:{color:"#67C23A"},areaStyle:{color:new q(0,0,0,1,[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.05)"}])}},{name:"Upload",type:"line",smooth:!0,data:n.value,itemStyle:{color:"#409EFF"},areaStyle:{color:new q(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}])}}]};u.setOption(l)};let A=null,R=null;return ee(()=>{V(),k(),H(),W(),setTimeout(()=>{J()},100),A=setInterval(()=>{k()},3e3),R=setInterval(()=>{V(),W()},5e3)}),ae(()=>{A&&clearInterval(A),R&&clearInterval(R),u&&u.dispose()}),(l,o)=>{const i=te("loading");return T(),B(e(Q),{title:"IPTV Dashboard",message:"Monitor and manage your IPTV system"},{default:t(()=>[a(e(F),{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[a(e(d),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(f),{title:"Total Playlists",value:v.value.total_playlists},{prefix:t(()=>[a(e(c),{icon:"ep:folder"})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(d),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(f),{title:"Total Channels",value:v.value.total_channels},{prefix:t(()=>[a(e(c),{icon:"ep:video-camera"})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(d),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(f),{title:"Channels Being Watched",value:v.value.active_channels},{prefix:t(()=>[a(e(c),{icon:"ep:video-play",style:{color:"#67c23a"}})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(d),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(f),{title:"Total Relays",value:v.value.total_relays},{prefix:t(()=>[a(e(c),{icon:"ep:connection"})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(e(y),{style:{"margin-bottom":"20px"}},{header:t(()=>[_("div",oe,[a(e(c),{icon:"ep:odometer"}),o[0]||(o[0]=_("span",null,"Bandwidth Monitor",-1))])]),default:t(()=>[o[1]||(o[1]=_("div",{id:"bandwidthChart",style:{width:"100%",height:"300px","margin-bottom":"20px"}},null,-1)),a(e(F),{gutter:15},{default:t(()=>[a(e(d),{xs:12,sm:6},{default:t(()=>[a(e(f),{title:"Download (Mbps)",value:s.value.downloadMbps,precision:2},{prefix:t(()=>[a(e(c),{icon:"ep:download",style:{color:"#67c23a"}})]),_:1},8,["value"])]),_:1}),a(e(d),{xs:12,sm:6},{default:t(()=>[a(e(f),{title:"Upload (Mbps)",value:s.value.uploadMbps,precision:2},{prefix:t(()=>[a(e(c),{icon:"ep:upload",style:{color:"#409eff"}})]),_:1},8,["value"])]),_:1}),a(e(d),{xs:12,sm:6},{default:t(()=>[a(e(f),{title:"Total Download (MB)",value:s.value.totalDownloadMB,precision:2},null,8,["value"])]),_:1}),a(e(d),{xs:12,sm:6},{default:t(()=>[a(e(f),{title:"Total Upload (MB)",value:s.value.totalUploadMB,precision:2},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(F),{gutter:20},{default:t(()=>[a(e(d),{xs:24,sm:24,md:12},{default:t(()=>[a(e(y),null,{header:t(()=>[_("div",se,[a(e(c),{icon:"ep:video-play",style:{color:"#67c23a"}}),o[2]||(o[2]=_("span",null,"Currently Being Watched",-1))])]),default:t(()=>[j((T(),B(e(z),{data:C.value,style:{width:"100%"}},{default:t(()=>[a(e(b),{prop:"name",label:"Channel Name","min-width":"180"}),a(e(b),{prop:"category",label:"Category",width:"120"}),a(e(b),{label:"Viewers",width:"100",align:"center"},{default:t(({row:r})=>[a(e(U),{type:"success"},{default:t(()=>[L(le(r.viewer_count),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[i,O.value]])]),_:1})]),_:1}),a(e(d),{xs:24,sm:24,md:12},{default:t(()=>[a(e(y),null,{header:t(()=>[_("div",ne,[a(e(c),{icon:"ep:video-play"}),o[3]||(o[3]=_("span",null,"Recently Watched Channels",-1))])]),default:t(()=>[j((T(),B(e(z),{data:M.value,style:{width:"100%"}},{default:t(()=>[a(e(b),{prop:"name",label:"Channel Name","min-width":"180"}),a(e(b),{prop:"category",label:"Category",width:"120"}),a(e(b),{label:"Status",width:"100"},{default:t(({row:r})=>[r.enabled?(T(),B(e(U),{key:0,type:"success"},{default:t(()=>o[4]||(o[4]=[L("Active")])),_:1})):(T(),B(e(U),{key:1,type:"info"},{default:t(()=>o[5]||(o[5]=[L("Inactive")])),_:1}))]),_:1})]),_:1},8,["data"])),[[i,S.value]])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ge=X(ie,[["__scopeId","data-v-b2422ba6"]]);export{ge as default};
