var b=(V,h,i)=>new Promise((_,c)=>{var n=d=>{try{m(i.next(d))}catch(v){c(v)}},p=d=>{try{m(i.throw(d))}catch(v){c(v)}},m=d=>d.done?_(d.value):Promise.resolve(d.value).then(n,p);m((i=i.apply(V,h)).next())});import{_ as I}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C3jeulgB.js";import{r as C}from"./index-DTPVUMgb.js";/* empty css                     *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                    *//* empty css               */import{u as L,v as w,x as S,y as P,l as D,m as U,c as x,C as N,b as u}from"./element-plus-B47XQz09.js";import{j as T,r as f,c as q,e as M,a5 as j,C as k,l as g,D as o,t as y,G as l,u as t,k as A,F as B,Z as $,_ as E,I as O}from"./vue-chunks-B2QQ4E8c.js";const Y={style:{"max-width":"800px"}},Z={style:{"margin-bottom":"12px"}},H={style:{"margin-top":"8px"}},J={style:{"margin-left":"12px","font-size":"13px",color:"#909399"}},ie=T({__name:"GeneratePlaylist",setup(V){const h=f([]),i=f([]),_=f([]),c=f(""),n=f([]),p=f(""),m=f(!1),d=q(()=>i.value.map(e=>({key:e.id,label:e.name,disabled:!e.enabled}))),v=()=>b(this,null,function*(){try{const e=yield C.get({url:"/api/users"});e&&e.data&&(h.value=e.data)}catch(e){console.error("Error loading users:",e)}}),F=()=>b(this,null,function*(){try{const e=yield C.get({url:"/api/channels/search",params:{q:""}});if(e&&e.data){i.value=e.data;const a=new Set;i.value.forEach(r=>{r.category&&a.add(r.category)}),_.value=Array.from(a).sort()}}catch(e){console.error("Error loading channels:",e)}}),G=()=>{if(!p.value){u.warning("Please select a category first");return}const e=i.value.filter(r=>r.category===p.value&&r.enabled).map(r=>r.id),a=new Set([...n.value,...e]);n.value=Array.from(a),u.success(`Added ${e.length} channels from ${p.value}`)},R=()=>{n.value=[],u.info("Selection cleared")},z=()=>b(this,null,function*(){if(!c.value){u.warning("Please select a user");return}if(n.value.length===0){u.warning("Please select at least one channel");return}m.value=!0;try{const e=yield C.post({url:"/api/generate-playlist",data:{user_id:c.value,channel_ids:n.value}});if(e&&e.data){const a=e.data.url||e.data.playlist_url;u.success("Playlist generated successfully!"),a&&(navigator.clipboard.writeText(a),u.info("Playlist URL copied to clipboard"))}}catch(e){u.error("Failed to generate playlist")}finally{m.value=!1}});return M(()=>{v(),F()}),(e,a)=>{const r=j("Icon");return g(),k(t(I),{title:"Generate Playlist",message:"Create custom user playlists"},{default:o(()=>[y("div",Y,[l(t(L),{"label-width":"120px"},{default:o(()=>[l(t(w),{label:"Select User"},{default:o(()=>[l(t(S),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=s=>c.value=s),placeholder:"Choose user",style:{width:"100%"}},{default:o(()=>[(g(!0),A(B,null,$(h.value,s=>(g(),k(t(P),{key:s.id,label:s.username,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(t(w),{label:"Select Channels"},{default:o(()=>[y("div",Z,[l(t(D),{gutter:12},{default:o(()=>[l(t(U),{span:14},{default:o(()=>[l(t(S),{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=s=>p.value=s),placeholder:"Select category to add all channels",clearable:"",style:{width:"100%"}},{default:o(()=>[(g(!0),A(B,null,$(_.value,s=>(g(),k(t(P),{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(t(U),{span:10},{default:o(()=>[l(t(x),{type:"primary",onClick:G,style:{width:"100%"}},{default:o(()=>[l(r,{icon:"ep:plus"}),a[3]||(a[3]=E(" Add Category "))]),_:1})]),_:1})]),_:1}),y("div",H,[l(t(x),{size:"small",onClick:R},{default:o(()=>[l(r,{icon:"ep:delete"}),a[4]||(a[4]=E(" Clear All "))]),_:1}),y("span",J,O(n.value.length)+" channels selected ",1)])]),l(t(N),{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value=s),data:d.value,filterable:"",titles:["Available Channels","Selected Channels"],"button-texts":["Remove","Add"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(t(w),null,{default:o(()=>[l(t(x),{type:"primary",onClick:z,loading:m.value},{default:o(()=>[l(r,{icon:"ep:document-add"}),a[5]||(a[5]=E(" Generate Playlist "))]),_:1},8,["loading"])]),_:1})]),_:1}),a[6]||(a[6]=y("div",{style:{"margin-top":"24px",padding:"16px",background:"#f5f7fa","border-radius":"4px"}},[y("h4",{style:{margin:"0 0 8px 0","font-size":"14px"}},"Generated Playlist:"),y("p",{style:{margin:"0","font-size":"13px",color:"#606266"}}," After generation, the playlist URL will be automatically copied to your clipboard. You can share this URL with the selected user to access their custom channels. ")],-1))])]),_:1})}}});export{ie as default};
