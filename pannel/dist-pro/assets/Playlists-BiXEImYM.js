var C=(k,g,o)=>new Promise((v,m)=>{var n=p=>{try{y(o.next(p))}catch(w){m(w)}},r=p=>{try{y(o.throw(p))}catch(w){m(w)}},y=p=>p.done?v(p.value):Promise.resolve(p.value).then(n,r);y((o=o.apply(k,g)).next())});import{j as q,r as V,e as z,ac as j,C as T,l as B,D as s,t as E,L as K,G as a,u as l,_ as u,I as _,X as G}from"./vue-chunks-B2QQ4E8c.js";import{_ as O}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DT9K-ZQh.js";import{e as x,r as b}from"./index-CdpqmSva.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{c,q as X,r as h,s as H,t as F,u as R,v as P,w as D,x as J,y as U,b as d,k as M}from"./element-plus-tut8eD11.js";const Q={style:{"margin-bottom":"16px"}},W={style:{display:"flex","align-items":"center",gap:"8px"}},Y={style:{display:"flex",gap:"8px","justify-content":"center"}},pe=q({__name:"Playlists",setup(k){const g=V([]),o=V(!1),v=V(!1),m=V(!1),n=V({id:0,name:"",url:""}),r=V({name:"",type:"manual"}),y=()=>C(this,null,function*(){o.value=!0;try{const i=yield b.get({url:"/api/playlists"});i&&i.data&&(g.value=i.data)}catch(i){console.error("Error loading playlists:",i),d.error("Failed to load playlists")}finally{o.value=!1}}),p=()=>{r.value={name:"",type:"manual"},m.value=!0},w=()=>C(this,null,function*(){if(!r.value.name.trim()){d.warning("Please enter playlist name");return}try{yield b.post({url:"/api/playlists",data:{name:r.value.name,type:r.value.type}}),d.success("Playlist created successfully"),m.value=!1,y()}catch(i){d.error("Failed to create playlist")}}),N=i=>{n.value={id:i.id,name:i.name,url:i.url},v.value=!0},L=()=>C(this,null,function*(){try{yield b.put({url:`/api/playlists/${n.value.id}`,data:{name:n.value.name,url:n.value.url}}),d.success("Playlist updated successfully"),v.value=!1,y()}catch(i){d.error("Failed to update playlist")}}),A=(i,e)=>C(this,null,function*(){var f;try{yield M.confirm(`Re-import playlist "${e}" from its URL? This will update all channels.`,"Confirm Refresh",{confirmButtonText:"Refresh",cancelButtonText:"Cancel",type:"info"}),o.value=!0;const t=yield b.post({url:`/api/playlists/${i}/refresh`});d.success(`Playlist refreshed! ${((f=t.data)==null?void 0:f.channels_count)||0} channels updated`),y()}catch(t){t!=="cancel"&&d.error("Failed to refresh playlist")}finally{o.value=!1}}),I=(i,e)=>C(this,null,function*(){try{yield M.confirm(`Delete playlist "${e}" and all its channels?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),o.value=!0,yield b.delete({url:`/api/playlists/${i}`}),g.value=g.value.filter(f=>f.id!==i),d.success("Playlist deleted successfully")}catch(f){f!=="cancel"&&d.error("Failed to delete playlist")}finally{o.value=!1}}),S=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return z(()=>{y()}),(i,e)=>{const f=j("loading");return B(),T(l(O),{title:"Playlists",message:"Manage your M3U playlists"},{default:s(()=>[E("div",Q,[a(l(c),{type:"primary",onClick:p},{default:s(()=>[a(l(x),{icon:"ep:plus",style:{"margin-right":"4px"}}),e[8]||(e[8]=u(" Add Playlist "))]),_:1})]),K((B(),T(l(X),{data:g.value,style:{width:"100%"}},{default:s(()=>[a(l(h),{prop:"name",label:"Playlist Name","min-width":"200"},{default:s(({row:t})=>[E("div",W,[a(l(x),{icon:"ep:folder"}),E("strong",null,_(t.name),1)])]),_:1}),a(l(h),{prop:"url",label:"URL","min-width":"300","show-overflow-tooltip":""}),a(l(h),{prop:"channel_count",label:"Channels",width:"120",align:"center"},{default:s(({row:t})=>[a(l(H),{type:"primary"},{default:s(()=>[u(_(t.channel_count||0),1)]),_:2},1024)]),_:1}),a(l(h),{prop:"created_at",label:"Created",width:"180"},{default:s(({row:t})=>[u(_(S(t.created_at)),1)]),_:1}),a(l(h),{label:"Actions",width:"280",fixed:"right",align:"center"},{default:s(({row:t})=>[E("div",Y,[a(l(c),{type:"primary",size:"small",onClick:$=>N(t)},{default:s(()=>[a(l(x),{icon:"ep:edit"}),e[9]||(e[9]=u(" Edit "))]),_:2},1032,["onClick"]),a(l(c),{type:"success",size:"small",onClick:$=>A(t.id,t.name)},{default:s(()=>[a(l(x),{icon:"ep:refresh"}),e[10]||(e[10]=u(" Refresh "))]),_:2},1032,["onClick"]),a(l(c),{type:"danger",size:"small",onClick:$=>I(t.id,t.name)},{default:s(()=>[a(l(x),{icon:"ep:delete"}),e[11]||(e[11]=u(" Delete "))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[f,o.value]]),a(l(F),{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),title:"Add New Playlist",width:"500px"},{footer:s(()=>[a(l(c),{onClick:e[2]||(e[2]=t=>m.value=!1)},{default:s(()=>e[12]||(e[12]=[u("Cancel")])),_:1}),a(l(c),{type:"primary",onClick:w},{default:s(()=>e[13]||(e[13]=[u("Create")])),_:1})]),default:s(()=>[a(l(R),{model:r.value,"label-width":"100px"},{default:s(()=>[a(l(P),{label:"Name",required:""},{default:s(()=>[a(l(D),{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.name=t),placeholder:"Enter playlist name",onKeyup:G(w,["enter"])},null,8,["modelValue"])]),_:1}),a(l(P),{label:"Type"},{default:s(()=>[a(l(J),{modelValue:r.value.type,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.type=t),placeholder:"Select type",style:{width:"100%"}},{default:s(()=>[a(l(U),{label:"Manual",value:"manual"}),a(l(U),{label:"M3U",value:"m3u"}),a(l(U),{label:"Relay",value:"relay"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(l(F),{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t),title:"Edit Playlist",width:"500px"},{footer:s(()=>[a(l(c),{onClick:e[6]||(e[6]=t=>v.value=!1)},{default:s(()=>e[14]||(e[14]=[u("Cancel")])),_:1}),a(l(c),{type:"primary",onClick:L},{default:s(()=>e[15]||(e[15]=[u("Update")])),_:1})]),default:s(()=>[a(l(R),{model:n.value,"label-width":"100px"},{default:s(()=>[a(l(P),{label:"Name"},{default:s(()=>[a(l(D),{modelValue:n.value.name,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.name=t),placeholder:"Playlist name"},null,8,["modelValue"])]),_:1}),a(l(P),{label:"URL"},{default:s(()=>[a(l(D),{modelValue:n.value.url,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.url=t),placeholder:"M3U URL"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{pe as default};
