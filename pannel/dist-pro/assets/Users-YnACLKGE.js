var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var M=(u,i,n)=>i in u?Q(u,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[i]=n,B=(u,i)=>{for(var n in i||(i={}))Y.call(i,n)&&M(u,n,i[n]);if(S)for(var n of S(i))Z.call(i,n)&&M(u,n,i[n]);return u},F=(u,i)=>W(u,X(i));var g=(u,i,n)=>new Promise((w,y)=>{var v=d=>{try{o(n.next(d))}catch(b){y(b)}},C=d=>{try{o(n.throw(d))}catch(b){y(b)}},o=d=>d.done?w(d.value):Promise.resolve(d.value).then(v,C);o((n=n.apply(u,i)).next())});import{_ as A}from"./ContentWrap.vue_vue_type_script_setup_true_lang-B4E0vfYm.js";import{e as k,r as _}from"./index-CrbZKY8z.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{j as ee,ar as ae,r as D,N,e as te,ac as se,C as L,l as V,D as l,G as r,L as le,u as s,_ as p,I as E,k as z,t as re}from"./vue-chunks-B2QQ4E8c.js";import{c as f,q as ne,r as U,s as oe,t as I,u as q,v as $,w as T,b as m,k as P}from"./element-plus-B47XQz09.js";const ie={key:0},de={key:1},Ce=ee({__name:"Users",setup(u){const i=ae(),n=D([]),w=D(!1),y=D(!1),v=D(!1),C=D(null),o=N({username:"",password:"",duration_days:30}),d=N({days:30}),b=()=>g(this,null,function*(){w.value=!0;try{const t=yield _.get({url:"/api/users"});t&&t.data&&(n.value=t.data.map(e=>F(B({},e),{disabled:!e.is_active})))}catch(t){console.error("Error loading users:",t),m.error("Failed to load users")}finally{w.value=!1}}),R=()=>g(this,null,function*(){if(!o.username||!o.password){m.warning("Username and password are required");return}try{const t=yield _.post({url:"/api/users",data:o});t&&t.data&&n.value.unshift(F(B({},t.data),{disabled:!t.data.is_active})),m.success("User created successfully"),y.value=!1,o.username="",o.password="",o.duration_days=30}catch(t){m.error("Failed to create user")}}),j=t=>g(this,null,function*(){try{yield P.confirm(`Delete user "${t.username}"?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),yield _.delete({url:`/api/users/${t.id}`}),n.value=n.value.filter(e=>e.id!==t.id),m.success("User deleted successfully")}catch(e){e!=="cancel"&&m.error("Failed to delete user")}}),G=t=>{C.value=t,d.days=30,v.value=!0},h=()=>g(this,null,function*(){if(C.value)try{yield _.post({url:`/api/users/${C.value.id}/extend`,data:{days:d.days}}),m.success("Subscription extended successfully"),v.value=!1,b()}catch(t){m.error("Failed to extend subscription")}}),H=t=>g(this,null,function*(){const e=t.disabled?"enable":"disable",c=t.disabled?"Enable":"Disable";try{yield P.confirm(`${c} user "${t.username}"?`,`${c} User`,{confirmButtonText:c,cancelButtonText:"Cancel",type:"warning"});const a=yield _.post({url:`/api/users/${t.id}/toggle`});a&&a.data&&(t.is_active=a.data.is_active,t.disabled=!a.data.is_active),m.success(`User ${e}d successfully`)}catch(a){a!=="cancel"&&m.error(`Failed to ${e} user`)}}),J=t=>{if(!t)return"info";const e=new Date(t),c=new Date;return e<c?"danger":Math.floor((e.getTime()-c.getTime())/(1e3*60*60*24))<=7?"warning":"success"},K=t=>{if(!t)return"No expiry";const e=new Date(t);return e<new Date?"Expired":e.toLocaleDateString()},O=t=>{i.push(`/users/detail/${t.id}`)};return te(()=>{b()}),(t,e)=>{const c=se("loading");return V(),L(s(A),{title:"Users",message:"Manage user accounts and subscriptions"},{default:l(()=>[r(s(f),{type:"primary",onClick:e[0]||(e[0]=a=>y.value=!0),style:{"margin-bottom":"16px"}},{icon:l(()=>[r(s(k),{icon:"ep:plus"})]),default:l(()=>[e[9]||(e[9]=p(" Create New User "))]),_:1}),le((V(),L(s(ne),{data:n.value,style:{width:"100%"}},{default:l(()=>[r(s(U),{prop:"username",label:"Username","min-width":"150"},{default:l(({row:a})=>[r(s(f),{type:"primary",text:"",onClick:x=>O(a),style:{padding:"0"}},{default:l(()=>[p(E(a.username),1)]),_:2},1032,["onClick"])]),_:1}),r(s(U),{label:"Status",width:"120"},{default:l(({row:a})=>[r(s(oe),{type:J(a.expires_at)},{default:l(()=>[p(E(K(a.expires_at)),1)]),_:2},1032,["type"])]),_:1}),r(s(U),{label:"Days Remaining",width:"140"},{default:l(({row:a})=>{var x;return[a!=null&&a.is_expired?(V(),z("span",ie,"Expired")):(V(),z("span",de,E((x=a==null?void 0:a.days_remaining)!=null?x:"-"),1))]}),_:1}),r(s(U),{prop:"created_at",label:"Created",width:"180"},{default:l(({row:a})=>[p(E(new Date(a.created_at).toLocaleString()),1)]),_:1}),r(s(U),{label:"Actions",width:"300",fixed:"right"},{default:l(({row:a})=>[r(s(f),{type:"primary",size:"small",text:"",onClick:x=>G(a)},{icon:l(()=>[r(s(k),{icon:"ep:calendar"})]),default:l(()=>[e[10]||(e[10]=p(" Extend "))]),_:2},1032,["onClick"]),r(s(f),{type:a.disabled?"success":"warning",size:"small",text:"",onClick:x=>H(a)},{icon:l(()=>[r(s(k),{icon:a.disabled?"ep:check":"ep:close"},null,8,["icon"])]),default:l(()=>[p(" "+E(a.disabled?"Enable":"Disable"),1)]),_:2},1032,["type","onClick"]),r(s(f),{type:"danger",size:"small",onClick:x=>j(a)},{icon:l(()=>[r(s(k),{icon:"ep:delete"})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[c,w.value]]),r(s(I),{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a),title:"Create New User",width:"500px"},{footer:l(()=>[r(s(f),{onClick:e[4]||(e[4]=a=>y.value=!1)},{default:l(()=>e[13]||(e[13]=[p("Cancel")])),_:1}),r(s(f),{type:"primary",onClick:R},{default:l(()=>e[14]||(e[14]=[p("Create")])),_:1})]),default:l(()=>[r(s(q),{model:o,"label-width":"120px"},{default:l(()=>[r(s($),{label:"Username"},{default:l(()=>[r(s(T),{modelValue:o.username,"onUpdate:modelValue":e[1]||(e[1]=a=>o.username=a),placeholder:"Username"},null,8,["modelValue"])]),_:1}),r(s($),{label:"Password"},{default:l(()=>[r(s(T),{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=a=>o.password=a),type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"])]),_:1}),r(s($),{label:"Duration (Days)"},{default:l(()=>[r(s(T),{modelValue:o.duration_days,"onUpdate:modelValue":e[3]||(e[3]=a=>o.duration_days=a),modelModifiers:{number:!0},type:"number",placeholder:"30 (0 for unlimited)",style:{width:"100%"}},{append:l(()=>e[11]||(e[11]=[p("days")])),_:1},8,["modelValue"]),e[12]||(e[12]=re("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," Enter number of days (0 = unlimited) ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(s(I),{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=a=>v.value=a),title:"Extend Subscription",width:"400px"},{footer:l(()=>[r(s(f),{onClick:e[7]||(e[7]=a=>v.value=!1)},{default:l(()=>e[15]||(e[15]=[p("Cancel")])),_:1}),r(s(f),{type:"primary",onClick:h},{default:l(()=>e[16]||(e[16]=[p("Extend")])),_:1})]),default:l(()=>[r(s(q),{model:d,"label-width":"120px"},{default:l(()=>[r(s($),{label:"Days to Extend"},{default:l(()=>[r(s(T),{modelValue:d.days,"onUpdate:modelValue":e[6]||(e[6]=a=>d.days=a),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{Ce as default};
