var M=(S,p,s)=>new Promise((b,g)=>{var x=n=>{try{i(s.next(n))}catch(f){g(f)}},v=n=>{try{i(s.throw(n))}catch(f){g(f)}},i=n=>n.done?b(n.value):Promise.resolve(n.value).then(x,v);i((s=s.apply(S,p)).next())});import{_ as H}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CgRKdnM5.js";import{I as u,r as B,_ as J}from"./index-BAD9Fa6W.js";/* empty css               *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css               */import{i as K,L as W}from"./echarts-Bx5A8eFf.js";import{l as N,m as r,n as y,p as m,q as $,r as w,s as T}from"./element-plus-B47XQz09.js";import{j as Q,r as c,e as X,x as Y,ac as Z,C,l as D,D as t,G as a,u as e,t as _,L as G,_ as A,I as ee}from"./vue-chunks-B2QQ4E8c.js";const ae={style:{display:"flex","align-items":"center",gap:"8px"}},te={style:{display:"flex","align-items":"center",gap:"8px"}},le={style:{display:"flex","align-items":"center",gap:"8px"}},oe=20,se=Q({__name:"Dashboard",setup(S){const p=c({total_playlists:0,total_channels:0,active_channels:0,total_relays:0}),s=c({downloadMbps:0,uploadMbps:0,totalDownloadMB:0,totalUploadMB:0}),b=c([]),g=c([]),x=c([]);let v=null;const i=c([]),n=c([]),f=c(!1),q=c(!1),R=()=>M(this,null,function*(){try{const l=yield B.get({url:"/api/stats"});l&&l.data&&(p.value=l.data)}catch(l){console.error("Error loading stats:",l),p.value={total_playlists:0,total_channels:0,active_channels:0,total_relays:0}}}),U=()=>M(this,null,function*(){try{const l=yield B.get({url:"/api/streams/status"});if(l&&l.data){const o=Array.isArray(l.data.streams)?l.data.streams:[],h=Number(l.data.total_bytes_read||0),d=Number(l.data.total_bytes_write||0);let V=0,k=0;for(const P of o)V+=Number(P.download_mbps||0),k+=Number(P.upload_mbps||0);s.value={downloadMbps:Number(V.toFixed(2)),uploadMbps:Number(k.toFixed(2)),totalDownloadMB:Number((h/1024/1024).toFixed(2)),totalUploadMB:Number((d/1024/1024).toFixed(2))};const O=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});b.value.push(O),g.value.push(s.value.downloadMbps),x.value.push(s.value.uploadMbps),b.value.length>oe&&(b.value.shift(),g.value.shift(),x.value.shift()),F()}}catch(l){console.error("Error loading bandwidth:",l),s.value={downloadMbps:0,uploadMbps:0,totalDownloadMB:0,totalUploadMB:0}}}),z=()=>M(this,null,function*(){f.value=!0;try{const l=yield B.get({url:"/api/recently-watched"});l&&l.data?(i.value=Array.isArray(l.data)?l.data:[],i.value):i.value=[]}catch(l){console.error("Error loading recently watched channels:",l),i.value=[]}finally{f.value=!1}}),L=()=>M(this,null,function*(){try{const l=yield B.get({url:"/api/active-channels"});l&&Array.isArray(l.data)?(n.value=l.data,n.value):n.value=[]}catch(l){console.error("Error loading active channels:",l),n.value=[]}}),j=()=>{const l=document.getElementById("bandwidthChart");l&&(v=K(l),F())},F=()=>{if(!v)return;const l={title:{text:"Real-time Bandwidth",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:o=>{let h=o[0].name+"<br/>";return o.forEach(d=>{h+=`${d.marker} ${d.seriesName}: ${d.value} Mbps<br/>`}),h}},legend:{data:["Download","Upload"],top:30},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:b.value,axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:"Mbps",axisLabel:{formatter:"{value}"}},series:[{name:"Download",type:"line",smooth:!0,data:g.value,itemStyle:{color:"#67C23A"},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.05)"}])}},{name:"Upload",type:"line",smooth:!0,data:x.value,itemStyle:{color:"#409EFF"},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}])}}]};v.setOption(l)};let E=null,I=null;return X(()=>{R(),U(),z(),L(),setTimeout(()=>{j()},100),E=setInterval(()=>{U()},3e3),I=setInterval(()=>{R(),L()},5e3)}),Y(()=>{E&&clearInterval(E),I&&clearInterval(I),v&&v.dispose()}),(l,o)=>{const h=Z("loading");return D(),C(e(H),{title:"IPTV Dashboard",message:"Monitor and manage your IPTV system"},{default:t(()=>[a(e(N),{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[a(e(r),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(m),{title:"Total Playlists",value:p.value.total_playlists},{prefix:t(()=>[a(e(u),{icon:"ep:folder"})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(r),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(m),{title:"Total Channels",value:p.value.total_channels},{prefix:t(()=>[a(e(u),{icon:"ep:video-camera"})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(r),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(m),{title:"Channels Being Watched",value:p.value.active_channels},{prefix:t(()=>[a(e(u),{icon:"ep:video-play",style:{color:"#67c23a"}})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(r),{xs:12,sm:12,md:6},{default:t(()=>[a(e(y),{shadow:"hover"},{default:t(()=>[a(e(m),{title:"Total Relays",value:p.value.total_relays},{prefix:t(()=>[a(e(u),{icon:"ep:connection"})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(e(y),{style:{"margin-bottom":"20px"}},{header:t(()=>[_("div",ae,[a(e(u),{icon:"ep:odometer"}),o[0]||(o[0]=_("span",null,"Bandwidth Monitor",-1))])]),default:t(()=>[o[1]||(o[1]=_("div",{id:"bandwidthChart",style:{width:"100%",height:"300px","margin-bottom":"20px"}},null,-1)),a(e(N),{gutter:15},{default:t(()=>[a(e(r),{xs:12,sm:6},{default:t(()=>[a(e(m),{title:"Download (Mbps)",value:s.value.downloadMbps,precision:2},{prefix:t(()=>[a(e(u),{icon:"ep:download",style:{color:"#67c23a"}})]),_:1},8,["value"])]),_:1}),a(e(r),{xs:12,sm:6},{default:t(()=>[a(e(m),{title:"Upload (Mbps)",value:s.value.uploadMbps,precision:2},{prefix:t(()=>[a(e(u),{icon:"ep:upload",style:{color:"#409eff"}})]),_:1},8,["value"])]),_:1}),a(e(r),{xs:12,sm:6},{default:t(()=>[a(e(m),{title:"Total Download (MB)",value:s.value.totalDownloadMB,precision:2},null,8,["value"])]),_:1}),a(e(r),{xs:12,sm:6},{default:t(()=>[a(e(m),{title:"Total Upload (MB)",value:s.value.totalUploadMB,precision:2},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(N),{gutter:20},{default:t(()=>[a(e(r),{xs:24,sm:24,md:12},{default:t(()=>[a(e(y),null,{header:t(()=>[_("div",te,[a(e(u),{icon:"ep:video-play",style:{color:"#67c23a"}}),o[2]||(o[2]=_("span",null,"Currently Being Watched",-1))])]),default:t(()=>[G((D(),C(e($),{data:n.value,style:{width:"100%"}},{default:t(()=>[a(e(w),{prop:"name",label:"Channel Name","min-width":"180"}),a(e(w),{prop:"category",label:"Category",width:"120"}),a(e(w),{label:"Viewers",width:"100",align:"center"},{default:t(({row:d})=>[a(e(T),{type:"success"},{default:t(()=>[A(ee(d.viewer_count),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[h,q.value]])]),_:1})]),_:1}),a(e(r),{xs:24,sm:24,md:12},{default:t(()=>[a(e(y),null,{header:t(()=>[_("div",le,[a(e(u),{icon:"ep:video-play"}),o[3]||(o[3]=_("span",null,"Recently Watched Channels",-1))])]),default:t(()=>[G((D(),C(e($),{data:i.value,style:{width:"100%"}},{default:t(()=>[a(e(w),{prop:"name",label:"Channel Name","min-width":"180"}),a(e(w),{prop:"category",label:"Category",width:"120"}),a(e(w),{label:"Status",width:"100"},{default:t(({row:d})=>[d.enabled?(D(),C(e(T),{key:0,type:"success"},{default:t(()=>o[4]||(o[4]=[A("Active")])),_:1})):(D(),C(e(T),{key:1,type:"info"},{default:t(()=>o[5]||(o[5]=[A("Inactive")])),_:1}))]),_:1})]),_:1},8,["data"])),[[h,f.value]])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ye=J(se,[["__scopeId","data-v-b32cab9c"]]);export{ye as default};
