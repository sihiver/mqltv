var g=(i,m,o)=>new Promise((a,s)=>{var R=t=>{try{c(o.next(t))}catch(d){s(d)}},p=t=>{try{c(o.throw(t))}catch(d){s(d)}},c=t=>t.done?a(t.value):Promise.resolve(t.value).then(R,p);c((o=o.apply(i,m)).next())});import{u as V,a as L,F as j}from"./useValidator-Dq3SEVku.js";import{a as N,f as C,d as M,b as q,g as U,l as z,h as B,i as O}from"./index-CrbZKY8z.js";/* empty css                    */import{j as T,ar as $,N as G,G as l,F as _,r as v,_ as J,e as K,d as H,u as w,C as Q,l as W,$ as X}from"./vue-chunks-B2QQ4E8c.js";import{I as Y,J as Z}from"./element-plus-B47XQz09.js";function ee(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!X(i)}const le=T({__name:"LoginForm",setup(i){const{required:m}=V(),o=N(),a=C(),s=M(),{currentRoute:R,addRoute:p,push:c}=$(),{t}=q(),d={username:[m()],password:[m()]},x=G([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>l("h2",{class:"text-2xl font-bold text-center w-[100%]"},[t("login.login")])}}},{field:"username",label:t("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"username"}},{field:"password",label:t("login.password"),component:"Input",colProps:{span:24},componentProps:{type:"password",showPassword:!0,style:{width:"100%"},placeholder:"password",onKeydown:e=>{e.key==="Enter"&&(e.stopPropagation(),P())}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>l(_,null,[l("div",{class:"flex justify-between items-center w-[100%]"},[l(Y,{modelValue:f.value,"onUpdate:modelValue":e=>f.value=e,label:"Remember me",size:"small"},null),l(Z,{type:"primary",underline:!1},{default:()=>[J("Forgot password?")]})])])}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return l(_,null,[l("div",{class:"w-[100%]"},[l(U,{loading:h.value,type:"primary",class:"w-[100%]",onClick:P},ee(e=t("login.login"))?e:{default:()=>[e]})])])}}}}]),f=v(a.getRememberMe),k=()=>{const e=a.getLoginInfo;if(e){const{username:r,password:n}=e;F({username:r,password:n})}};K(()=>{k()});const{formRegister:S,formMethods:A}=L(),{getFormData:I,getElFormExpose:D,setValues:F}=A,h=v(!1),y=v("");H(()=>R.value,e=>{var r;y.value=(r=e==null?void 0:e.query)==null?void 0:r.redirect},{immediate:!0});const P=()=>g(this,null,function*(){const e=yield D();yield e==null?void 0:e.validate(r=>g(this,null,function*(){if(r){h.value=!0;const n=yield I();try{const u=yield z(n);u&&(w(f)?a.setLoginInfo({username:n.username,password:n.password}):a.setLoginInfo(void 0),a.setRememberMe(w(f)),a.setUserInfo(u.data),o.getDynamicRouter?E():(yield s.generateRoutes("static").catch(()=>{}),s.getAddRouters.forEach(b=>{p(b)}),s.setIsAddRouters(!0),c({path:y.value||"/dashboard/index"})))}finally{h.value=!1}}}))}),E=()=>g(this,null,function*(){const r={roleName:(yield I()).username},n=o.getDynamicRouter&&o.getServerDynamicRouter?yield B():yield O(r);if(n){const u=n.data||[];a.setRoleRouters(u),o.getDynamicRouter&&o.getServerDynamicRouter?yield s.generateRoutes("server",u).catch(()=>{}):yield s.generateRoutes("frontEnd",u).catch(()=>{}),s.getAddRouters.forEach(b=>{p(b)}),s.setIsAddRouters(!0),c({path:y.value||"/dashboard/index"})}});return(e,r)=>(W(),Q(w(j),{schema:x,rules:d,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:w(S)},null,8,["schema","onRegister"]))}});export{le as _};
