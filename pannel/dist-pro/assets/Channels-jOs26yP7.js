var _=($,u,g)=>new Promise((b,y)=>{var h=c=>{try{i(g.next(c))}catch(p){y(p)}},C=c=>{try{i(g.throw(c))}catch(p){y(p)}},i=c=>c.done?b(c.value):Promise.resolve(c.value).then(h,C);i((g=g.apply($,u)).next())});import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C3jeulgB.js";import{e as x,r as w}from"./index-DTPVUMgb.js";/* empty css               *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                      *//* empty css                  *//* empty css                     */import{l as de,m as L,w as D,x as O,y as Q,c as E,q as ce,r as T,s as Z,z as pe,t as ve,u as me,v as B,b as v,k as H}from"./element-plus-B47XQz09.js";import{j as fe,r,c as J,w as ge,d as ye,e as he,x as Ce,ac as _e,C as S,l as m,D as o,G as n,L as xe,t as k,u as a,k as P,F as K,Z as W,_ as f,I as N,A as we}from"./vue-chunks-B2QQ4E8c.js";const be={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},Ve={style:{display:"flex","align-items":"center",gap:"12px"}},Ee=["src","alt"],Se={style:{"font-weight":"600"}},ke={style:{"font-size":"12px",color:"#909399"}},ze={style:{"margin-top":"20px",display:"flex","justify-content":"center"}},Me=fe({__name:"Channels",setup($){const u=r([]),g=r(new Set),b=r([]),y=r([]),h=r(""),C=r(""),i=r(new Set),c=r(!1),p=r(1),z=r(20),q=r(0),A=r(),V=r(!1),F=r(""),U=r(!1),s=r({id:0,playlist_id:0,name:"",url:"",logo:"",group_name:""}),R=J(()=>{let l=u.value;if(h.value){const e=h.value.toLowerCase();l=l.filter(d=>d.name.toLowerCase().includes(e)||d.category&&d.category.toLowerCase().includes(e))}return C.value&&(l=l.filter(e=>e.category===C.value)),l}),j=J(()=>{const l=R.value,e=(p.value-1)*z.value,d=e+z.value;return l.slice(e,d)});ge(()=>{q.value=R.value.length});const X=l=>{p.value=l,M()},Y=l=>{z.value=l,p.value=1,M()},M=()=>{A.value&&setTimeout(()=>{j.value.forEach(l=>{const e=i.value.has(l.id);A.value.toggleRowSelection(l,e)})},10)};ye([h,C],()=>{p.value=1});const ee=()=>_(this,null,function*(){c.value=!0;try{const l=yield w.get({url:"/api/channels/search",params:{q:""}});if(l&&l.data){u.value=l.data;const e=new Set;u.value.forEach(d=>{d.category&&e.add(d.category)}),b.value=Array.from(e).sort()}}catch(l){console.error("Error loading channels:",l),v.error("Failed to load channels")}finally{c.value=!1}}),le=l=>{i.value=new Set(l.map(e=>e.id))},ae=()=>_(this,null,function*(){try{const l=yield w.get({url:"/api/playlists"});l&&l.data&&(y.value=l.data)}catch(l){console.error("Error loading playlists:",l)}}),G=()=>_(this,null,function*(){try{const l=yield w.get({url:"/api/active-channels"});l&&Array.isArray(l.data)&&(g.value=new Set(l.data.map(e=>e.id)))}catch(l){console.error("Error loading active channels:",l)}}),te=()=>{F.value="Add New Channel",U.value=!1,s.value={id:0,playlist_id:y.value.length>0?y.value[0].id:0,name:"",url:"",logo:"",group_name:""},V.value=!0},ne=l=>{F.value="Edit Channel",U.value=!0,s.value={id:l.id,playlist_id:l.playlist_id,name:l.name,url:l.url,logo:l.logo,group_name:l.category||""},V.value=!0},oe=()=>_(this,null,function*(){if(!s.value.name||!s.value.url){v.warning("Name and URL are required");return}try{if(U.value){const l=yield w.put({url:`/api/channels/${s.value.id}`,data:{name:s.value.name,url:s.value.url,logo:s.value.logo,group_name:s.value.group_name}}),e=u.value.findIndex(d=>d.id===s.value.id);e!==-1&&l.data&&(u.value[e]=l.data),v.success("Channel updated successfully")}else{const l=yield w.post({url:"/api/channels",data:{playlist_id:s.value.playlist_id,name:s.value.name,url:s.value.url,logo:s.value.logo,group_name:s.value.group_name}});l.data&&(u.value.unshift(l.data),l.data.category&&!b.value.includes(l.data.category)&&b.value.push(l.data.category)),v.success("Channel created successfully")}V.value=!1}catch(l){v.error(U.value?"Failed to update channel":"Failed to create channel")}}),se=l=>_(this,null,function*(){try{yield H.confirm(`Delete channel "${l.name}"?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),yield w.delete({url:`/api/channels/${l.id}`}),u.value=u.value.filter(e=>e.id!==l.id),v.success("Channel deleted successfully")}catch(e){e!=="cancel"&&v.error("Failed to delete channel")}}),re=()=>_(this,null,function*(){if(i.value.size!==0)try{yield H.confirm(`Delete ${i.value.size} selected channels?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"});const l=Array.from(i.value);yield w.post({url:"/api/channels/batch-delete",data:{ids:l}}),u.value=u.value.filter(e=>!l.includes(e.id)),v.success("Channels deleted successfully"),i.value.clear()}catch(l){l!=="cancel"&&v.error("Failed to delete channels")}});let I=null;return he(()=>{ee(),ae(),G(),I=setInterval(()=>{G()},5e3)}),Ce(()=>{I&&clearInterval(I)}),(l,e)=>{const d=_e("loading");return m(),S(a(ie),{title:"Channels",message:"Manage IPTV channels"},{default:o(()=>[n(a(de),{gutter:12,style:{"margin-bottom":"16px"}},{default:o(()=>[n(a(L),{xs:24,sm:12,md:8},{default:o(()=>[n(a(D),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"Search channels...",clearable:""},{prefix:o(()=>[n(a(x),{icon:"ep:search"})]),_:1},8,["modelValue"])]),_:1}),n(a(L),{xs:24,sm:12,md:8},{default:o(()=>[n(a(O),{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),placeholder:"All Categories",clearable:"",style:{width:"100%"}},{default:o(()=>[(m(!0),P(K,null,W(b.value,t=>(m(),S(a(Q),{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(a(L),{xs:24,sm:24,md:8},{default:o(()=>[k("div",be,[n(a(E),{type:"primary",onClick:te},{default:o(()=>[n(a(x),{icon:"ep:plus"}),e[11]||(e[11]=f(" Add Channel "))]),_:1}),n(a(E),{type:"danger",disabled:i.value.size===0,onClick:re},{default:o(()=>[n(a(x),{icon:"ep:delete"}),f(" Delete ("+N(i.value.size)+") ",1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),xe((m(),S(a(ce),{ref_key:"tableRef",ref:A,data:j.value,"row-key":"id",onSelectionChange:le,style:{width:"100%"}},{default:o(()=>[n(a(T),{type:"selection",width:"55"}),n(a(T),{label:"Channel","min-width":"250"},{default:o(({row:t})=>[k("div",Ve,[t.logo?(m(),P("img",{key:0,src:t.logo,alt:t.name,style:{width:"48px",height:"48px","object-fit":"contain","border-radius":"4px"}},null,8,Ee)):we("",!0),k("div",null,[k("div",Se,N(t.name),1),k("div",ke,N(t.category||"Uncategorized"),1)])])]),_:1}),n(a(T),{prop:"playlist_name",label:"Playlist",width:"150"}),n(a(T),{label:"Status",width:"120"},{default:o(({row:t})=>[g.value.has(t.id)?(m(),S(a(Z),{key:0,type:"success"},{default:o(()=>[n(a(x),{icon:"ep:video-play",style:{"margin-right":"4px"}}),e[12]||(e[12]=f(" Streaming "))]),_:1})):(m(),S(a(Z),{key:1,type:"info"},{default:o(()=>[n(a(x),{icon:"ep:video-pause",style:{"margin-right":"4px"}}),e[13]||(e[13]=f(" Stopped "))]),_:1}))]),_:1}),n(a(T),{label:"Actions",width:"240",fixed:"right"},{default:o(({row:t})=>[n(a(E),{type:"primary",size:"small",onClick:ue=>ne(t)},{default:o(()=>[n(a(x),{icon:"ep:edit"}),e[14]||(e[14]=f(" Edit "))]),_:2},1032,["onClick"]),n(a(E),{type:"danger",size:"small",onClick:ue=>se(t)},{default:o(()=>[n(a(x),{icon:"ep:delete"}),e[15]||(e[15]=f(" Delete "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[d,c.value]]),k("div",ze,[n(a(pe),{"current-page":p.value,"onUpdate:currentPage":e[2]||(e[2]=t=>p.value=t),"page-size":z.value,"onUpdate:pageSize":e[3]||(e[3]=t=>z.value=t),"page-sizes":[10,20,50,100],total:q.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:X},null,8,["current-page","page-size","total"])]),n(a(ve),{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),title:F.value,width:"600px"},{footer:o(()=>[n(a(E),{onClick:e[9]||(e[9]=t=>V.value=!1)},{default:o(()=>e[16]||(e[16]=[f("Cancel")])),_:1}),n(a(E),{type:"primary",onClick:oe},{default:o(()=>e[17]||(e[17]=[f("Save")])),_:1})]),default:o(()=>[n(a(me),{model:s.value,"label-width":"120px"},{default:o(()=>[n(a(B),{label:"Playlist"},{default:o(()=>[n(a(O),{modelValue:s.value.playlist_id,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.playlist_id=t),placeholder:"Select Playlist",style:{width:"100%"},disabled:U.value},{default:o(()=>[(m(!0),P(K,null,W(y.value,t=>(m(),S(a(Q),{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),n(a(B),{label:"Channel Name",required:""},{default:o(()=>[n(a(D),{modelValue:s.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.name=t),placeholder:"Enter channel name"},null,8,["modelValue"])]),_:1}),n(a(B),{label:"URL",required:""},{default:o(()=>[n(a(D),{modelValue:s.value.url,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.url=t),placeholder:"http://..."},null,8,["modelValue"])]),_:1}),n(a(B),{label:"Logo URL"},{default:o(()=>[n(a(D),{modelValue:s.value.logo,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.logo=t),placeholder:"http://..."},null,8,["modelValue"])]),_:1}),n(a(B),{label:"Category"},{default:o(()=>[n(a(D),{modelValue:s.value.group_name,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.group_name=t),placeholder:"e.g., Sports, News, Entertainment"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}});export{Me as default};
