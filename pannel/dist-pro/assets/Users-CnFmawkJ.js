var O=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var B=(u,d,o)=>d in u?O(u,d,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[d]=o,F=(u,d)=>{for(var o in d||(d={}))X.call(d,o)&&B(u,o,d[o]);if(T)for(var o of T(d))Y.call(d,o)&&B(u,o,d[o]);return u},S=(u,d)=>Q(u,W(d));var b=(u,d,o)=>new Promise((x,y)=>{var w=i=>{try{n(o.next(i))}catch(v){y(v)}},g=i=>{try{n(o.throw(i))}catch(v){y(v)}},n=i=>i.done?x(i.value):Promise.resolve(i.value).then(w,g);n((o=o.apply(u,d)).next())});import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C__ChExg.js";import{e as D,r as C}from"./index-BgnVcGCp.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{j as h,ar as ee,r as U,N as M,e as te,ac as ae,C as N,l as L,D as l,G as r,L as se,u as s,_ as p,I as E,t as le}from"./vue-chunks-B2QQ4E8c.js";import{c as f,q as re,r as V,s as oe,t as z,u as I,v as $,w as k,b as m,k as q}from"./element-plus-B47XQz09.js";const be=h({__name:"Users",setup(u){const d=ee(),o=U([]),x=U(!1),y=U(!1),w=U(!1),g=U(null),n=M({username:"",password:"",duration_days:30}),i=M({days:30}),v=()=>b(this,null,function*(){x.value=!0;try{const a=yield C.get({url:"/api/users"});a&&a.data&&(o.value=a.data.map(e=>S(F({},e),{disabled:!e.is_active})))}catch(a){console.error("Error loading users:",a),m.error("Failed to load users")}finally{x.value=!1}}),P=()=>b(this,null,function*(){if(!n.username||!n.password){m.warning("Username and password are required");return}try{const a=yield C.post({url:"/api/users",data:n});a&&a.data&&o.value.unshift(a.data),m.success("User created successfully"),y.value=!1,n.username="",n.password="",n.duration_days=30}catch(a){m.error("Failed to create user")}}),j=a=>b(this,null,function*(){try{yield q.confirm(`Delete user "${a.username}"?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),yield C.delete({url:`/api/users/${a.id}`}),o.value=o.value.filter(e=>e.id!==a.id),m.success("User deleted successfully")}catch(e){e!=="cancel"&&m.error("Failed to delete user")}}),A=a=>{g.value=a,i.days=30,w.value=!0},G=()=>b(this,null,function*(){if(g.value)try{yield C.post({url:`/api/users/${g.value.id}/extend`,data:{days:i.days}}),m.success("Subscription extended successfully"),w.value=!1,v()}catch(a){m.error("Failed to extend subscription")}}),R=a=>b(this,null,function*(){const e=a.disabled?"enable":"disable",c=a.disabled?"Enable":"Disable";try{yield q.confirm(`${c} user "${a.username}"?`,`${c} User`,{confirmButtonText:c,cancelButtonText:"Cancel",type:"warning"});const t=yield C.post({url:`/api/users/${a.id}/toggle`});t&&t.data&&(a.is_active=t.data.is_active,a.disabled=!t.data.is_active),m.success(`User ${e}d successfully`)}catch(t){t!=="cancel"&&m.error(`Failed to ${e} user`)}}),H=a=>{if(!a)return"info";const e=new Date(a),c=new Date;return e<c?"danger":Math.floor((e.getTime()-c.getTime())/(1e3*60*60*24))<=7?"warning":"success"},J=a=>{if(!a)return"No expiry";const e=new Date(a);return e<new Date?"Expired":e.toLocaleDateString()},K=a=>{d.push(`/users/detail/${a.id}`)};return te(()=>{v()}),(a,e)=>{const c=ae("loading");return L(),N(s(Z),{title:"Users",message:"Manage user accounts and subscriptions"},{default:l(()=>[r(s(f),{type:"primary",onClick:e[0]||(e[0]=t=>y.value=!0),style:{"margin-bottom":"16px"}},{icon:l(()=>[r(s(D),{icon:"ep:plus"})]),default:l(()=>[e[9]||(e[9]=p(" Create New User "))]),_:1}),se((L(),N(s(re),{data:o.value,style:{width:"100%"}},{default:l(()=>[r(s(V),{prop:"username",label:"Username","min-width":"150"},{default:l(({row:t})=>[r(s(f),{type:"primary",text:"",onClick:_=>K(t),style:{padding:"0"}},{default:l(()=>[p(E(t.username),1)]),_:2},1032,["onClick"])]),_:1}),r(s(V),{label:"Status",width:"120"},{default:l(({row:t})=>[r(s(oe),{type:H(t.expiry)},{default:l(()=>[p(E(J(t.expiry)),1)]),_:2},1032,["type"])]),_:1}),r(s(V),{prop:"created_at",label:"Created",width:"180"},{default:l(({row:t})=>[p(E(new Date(t.created_at).toLocaleString()),1)]),_:1}),r(s(V),{label:"Actions",width:"300",fixed:"right"},{default:l(({row:t})=>[r(s(f),{type:"primary",size:"small",text:"",onClick:_=>A(t)},{icon:l(()=>[r(s(D),{icon:"ep:calendar"})]),default:l(()=>[e[10]||(e[10]=p(" Extend "))]),_:2},1032,["onClick"]),r(s(f),{type:t.disabled?"success":"warning",size:"small",text:"",onClick:_=>R(t)},{icon:l(()=>[r(s(D),{icon:t.disabled?"ep:check":"ep:close"},null,8,["icon"])]),default:l(()=>[p(" "+E(t.disabled?"Enable":"Disable"),1)]),_:2},1032,["type","onClick"]),r(s(f),{type:"danger",size:"small",onClick:_=>j(t)},{icon:l(()=>[r(s(D),{icon:"ep:delete"})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[c,x.value]]),r(s(z),{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),title:"Create New User",width:"500px"},{footer:l(()=>[r(s(f),{onClick:e[4]||(e[4]=t=>y.value=!1)},{default:l(()=>e[13]||(e[13]=[p("Cancel")])),_:1}),r(s(f),{type:"primary",onClick:P},{default:l(()=>e[14]||(e[14]=[p("Create")])),_:1})]),default:l(()=>[r(s(I),{model:n,"label-width":"120px"},{default:l(()=>[r(s($),{label:"Username"},{default:l(()=>[r(s(k),{modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=t=>n.username=t),placeholder:"Username"},null,8,["modelValue"])]),_:1}),r(s($),{label:"Password"},{default:l(()=>[r(s(k),{modelValue:n.password,"onUpdate:modelValue":e[2]||(e[2]=t=>n.password=t),type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"])]),_:1}),r(s($),{label:"Duration (Days)"},{default:l(()=>[r(s(k),{modelValue:n.duration_days,"onUpdate:modelValue":e[3]||(e[3]=t=>n.duration_days=t),modelModifiers:{number:!0},type:"number",placeholder:"30 (0 for unlimited)",style:{width:"100%"}},{append:l(()=>e[11]||(e[11]=[p("days")])),_:1},8,["modelValue"]),e[12]||(e[12]=le("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," Enter number of days (0 = unlimited) ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(s(z),{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value=t),title:"Extend Subscription",width:"400px"},{footer:l(()=>[r(s(f),{onClick:e[7]||(e[7]=t=>w.value=!1)},{default:l(()=>e[15]||(e[15]=[p("Cancel")])),_:1}),r(s(f),{type:"primary",onClick:G},{default:l(()=>e[16]||(e[16]=[p("Extend")])),_:1})]),default:l(()=>[r(s(I),{model:i,"label-width":"120px"},{default:l(()=>[r(s($),{label:"Days to Extend"},{default:l(()=>[r(s(k),{modelValue:i.days,"onUpdate:modelValue":e[6]||(e[6]=t=>i.days=t),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{be as default};
