var w=(S,_,d)=>new Promise((x,c)=>{var n=i=>{try{m(d.next(i))}catch(v){c(v)}},p=i=>{try{m(d.throw(i))}catch(v){c(v)}},m=i=>i.done?x(i.value):Promise.resolve(i.value).then(n,p);m((d=d.apply(S,_)).next())});import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CG9jHVlV.js";import{I as y,r as C}from"./index-BQp2Wyj5.js";/* empty css                     *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                    *//* empty css               */import{l as U,m as g,n as b,u as L,v as N,x as P,y as A,c as E,C as T,b as u}from"./element-plus-B47XQz09.js";import{j,r as f,c as q,e as M,C as k,l as h,D as o,G as t,u as a,k as B,F as $,Z as F,t as r,_ as V,I as O}from"./vue-chunks-B2QQ4E8c.js";const Z={style:{display:"flex","align-items":"center",gap:"8px"}},H={style:{display:"flex","align-items":"center",gap:"8px"}},J={style:{display:"flex","align-items":"center","justify-content":"space-between"}},K={style:{display:"flex","align-items":"center",gap:"8px"}},Q={style:{"font-size":"13px",color:"#909399"}},W={style:{"margin-bottom":"12px"}},X={style:{"margin-top":"8px"}},ce=j({__name:"GeneratePlaylist",setup(S){const _=f([]),d=f([]),x=f([]),c=f(""),n=f([]),p=f(""),m=f(!1),i=q(()=>d.value.map(l=>({key:l.id,label:l.name,disabled:!l.enabled}))),v=()=>w(this,null,function*(){try{const l=yield C.get({url:"/api/users"});l&&l.data&&(_.value=l.data)}catch(l){console.error("Error loading users:",l)}}),G=()=>w(this,null,function*(){try{const l=yield C.get({url:"/api/channels/search",params:{q:""}});if(l&&l.data){d.value=l.data;const e=new Set;d.value.forEach(s=>{s.category&&e.add(s.category)}),x.value=Array.from(e).sort()}}catch(l){console.error("Error loading channels:",l)}}),I=()=>{if(!p.value){u.warning("Please select a category first");return}const l=d.value.filter(s=>s.category===p.value&&s.enabled).map(s=>s.id),e=new Set([...n.value,...l]);n.value=Array.from(e),u.success(`Added ${l.length} channels from ${p.value}`)},R=()=>{n.value=[],u.info("Selection cleared")},z=()=>w(this,null,function*(){if(!c.value){u.warning("Please select a user");return}if(n.value.length===0){u.warning("Please select at least one channel");return}m.value=!0;try{const l=yield C.post({url:"/api/generate-playlist",data:{user_id:c.value,channel_ids:n.value}});if(l&&l.data){const e=l.data.url||l.data.playlist_url;u.success("Playlist generated successfully!"),e&&(navigator.clipboard.writeText(e),u.info("Playlist URL copied to clipboard"))}}catch(l){u.error("Failed to generate playlist")}finally{m.value=!1}});return M(()=>{v(),G()}),(l,e)=>(h(),k(a(D),{title:"Generate Playlist",message:"Create custom user playlists"},{default:o(()=>[t(a(U),{gutter:20},{default:o(()=>[t(a(g),{xs:24,md:12},{default:o(()=>[t(a(b),{shadow:"hover"},{header:o(()=>[r("div",Z,[t(a(y),{icon:"ep:user"}),e[3]||(e[3]=r("span",null,"Select User",-1))])]),default:o(()=>[t(a(L),{"label-width":"120px"},{default:o(()=>[t(a(N),{label:"User"},{default:o(()=>[t(a(P),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),placeholder:"Choose user",style:{width:"100%"}},{default:o(()=>[(h(!0),B($,null,F(_.value,s=>(h(),k(a(A),{key:s.id,label:s.username,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(a(g),{xs:24,md:12},{default:o(()=>[t(a(b),{shadow:"hover"},{header:o(()=>[r("div",H,[t(a(y),{icon:"ep:document-add"}),e[4]||(e[4]=r("span",null,"Generate",-1))])]),default:o(()=>[t(a(E),{type:"primary",onClick:z,loading:m.value,style:{width:"100%"}},{default:o(()=>[t(a(y),{icon:"ep:document-add"}),e[5]||(e[5]=V(" Generate Playlist "))]),_:1},8,["loading"]),e[6]||(e[6]=r("div",{style:{"margin-top":"12px","font-size":"13px",color:"#909399"}}," After generation, the playlist URL will be copied to clipboard. ",-1))]),_:1})]),_:1}),t(a(g),{xs:24,md:24,style:{"margin-top":"20px"}},{default:o(()=>[t(a(b),{shadow:"hover"},{header:o(()=>[r("div",J,[r("div",K,[t(a(y),{icon:"ep:video-camera"}),e[7]||(e[7]=r("span",null,"Select Channels",-1))]),r("div",Q,O(n.value.length)+" selected ",1)])]),default:o(()=>[r("div",W,[t(a(U),{gutter:12},{default:o(()=>[t(a(g),{xs:24,sm:16},{default:o(()=>[t(a(P),{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),placeholder:"Select category to add all channels",clearable:"",style:{width:"100%"}},{default:o(()=>[(h(!0),B($,null,F(x.value,s=>(h(),k(a(A),{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(a(g),{xs:24,sm:8},{default:o(()=>[t(a(E),{type:"primary",onClick:I,style:{width:"100%"}},{default:o(()=>[t(a(y),{icon:"ep:plus"}),e[8]||(e[8]=V(" Add Category "))]),_:1})]),_:1})]),_:1}),r("div",X,[t(a(E),{size:"small",onClick:R},{default:o(()=>[t(a(y),{icon:"ep:delete"}),e[9]||(e[9]=V(" Clear All "))]),_:1})])]),t(a(T),{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value=s),data:i.value,filterable:"",titles:["Available Channels","Selected Channels"],"button-texts":["Remove","Add"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1})]),_:1}))}});export{ce as default};
