var y=(T,V,i)=>new Promise((w,m)=>{var f=n=>{try{o(i.next(n))}catch(c){m(c)}},v=n=>{try{o(i.throw(n))}catch(c){m(c)}},o=n=>n.done?w(n.value):Promise.resolve(n.value).then(f,v);o((i=i.apply(T,V)).next())});import{_ as G}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C3jeulgB.js";import{e as b,r as g}from"./index-DTPVUMgb.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{j as H,ar as J,r as C,N as B,e as K,ac as O,C as F,l as _,D as a,G as s,L as Q,u as t,_ as d,I as $,t as W}from"./vue-chunks-B2QQ4E8c.js";import{c as p,q as X,r as E,s as Y,t as M,u as S,v as D,w as U,b as u,k as N}from"./element-plus-B47XQz09.js";const ie=H({__name:"Users",setup(T){const V=J(),i=C([]),w=C(!1),m=C(!1),f=C(!1),v=C(null),o=B({username:"",password:"",duration_days:30}),n=B({days:30}),c=()=>y(this,null,function*(){w.value=!0;try{const r=yield g.get({url:"/api/users"});r&&r.data&&(i.value=r.data)}catch(r){console.error("Error loading users:",r),u.error("Failed to load users")}finally{w.value=!1}}),P=()=>y(this,null,function*(){if(!o.username||!o.password){u.warning("Username and password are required");return}try{const r=yield g.post({url:"/api/users",data:o});r&&r.data&&i.value.unshift(r.data),u.success("User created successfully"),m.value=!1,o.username="",o.password="",o.duration_days=30}catch(r){u.error("Failed to create user")}}),L=r=>y(this,null,function*(){try{yield N.confirm(`Delete user "${r.username}"?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),yield g.delete({url:`/api/users/${r.id}`}),i.value=i.value.filter(e=>e.id!==r.id),u.success("User deleted successfully")}catch(e){e!=="cancel"&&u.error("Failed to delete user")}}),q=r=>{v.value=r,n.days=30,f.value=!0},z=()=>y(this,null,function*(){if(v.value)try{yield g.post({url:`/api/users/${v.value.id}/extend`,data:{days:n.days}}),u.success("Subscription extended successfully"),f.value=!1,c()}catch(r){u.error("Failed to extend subscription")}}),I=r=>y(this,null,function*(){try{const e=yield N.prompt(`Enter new password for user "${r.username}"`,"Reset Password",{confirmButtonText:"Reset",cancelButtonText:"Cancel",inputPattern:/.+/,inputErrorMessage:"Password is required"});yield g.post({url:`/api/users/${r.id}/reset-password`,data:{password:e.value}}),u.success("Password reset successfully")}catch(e){e!=="cancel"&&u.error("Failed to reset password")}}),R=r=>{if(!r)return"info";const e=new Date(r),x=new Date;return e<x?"danger":Math.floor((e.getTime()-x.getTime())/(1e3*60*60*24))<=7?"warning":"success"},j=r=>{if(!r)return"No expiry";const e=new Date(r);return e<new Date?"Expired":e.toLocaleDateString()},A=r=>{V.push(`/users/detail/${r.id}`)};return K(()=>{c()}),(r,e)=>{const x=O("loading");return _(),F(t(G),{title:"Users",message:"Manage user accounts and subscriptions"},{default:a(()=>[s(t(p),{type:"primary",onClick:e[0]||(e[0]=l=>m.value=!0),style:{"margin-bottom":"16px"}},{icon:a(()=>[s(t(b),{icon:"ep:plus"})]),default:a(()=>[e[9]||(e[9]=d(" Create New User "))]),_:1}),Q((_(),F(t(X),{data:i.value,style:{width:"100%"}},{default:a(()=>[s(t(E),{prop:"username",label:"Username","min-width":"150"},{default:a(({row:l})=>[s(t(p),{type:"primary",text:"",onClick:k=>A(l),style:{padding:"0"}},{default:a(()=>[d($(l.username),1)]),_:2},1032,["onClick"])]),_:1}),s(t(E),{label:"Status",width:"120"},{default:a(({row:l})=>[s(t(Y),{type:R(l.expiry)},{default:a(()=>[d($(j(l.expiry)),1)]),_:2},1032,["type"])]),_:1}),s(t(E),{prop:"created_at",label:"Created",width:"180"},{default:a(({row:l})=>[d($(new Date(l.created_at).toLocaleString()),1)]),_:1}),s(t(E),{label:"Actions",width:"300",fixed:"right"},{default:a(({row:l})=>[s(t(p),{type:"primary",size:"small",text:"",onClick:k=>q(l)},{icon:a(()=>[s(t(b),{icon:"ep:calendar"})]),default:a(()=>[e[10]||(e[10]=d(" Extend "))]),_:2},1032,["onClick"]),s(t(p),{type:"warning",size:"small",text:"",onClick:k=>I(l)},{icon:a(()=>[s(t(b),{icon:"ep:lock"})]),default:a(()=>[e[11]||(e[11]=d(" Reset "))]),_:2},1032,["onClick"]),s(t(p),{type:"danger",size:"small",onClick:k=>L(l)},{icon:a(()=>[s(t(b),{icon:"ep:delete"})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,w.value]]),s(t(M),{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value=l),title:"Create New User",width:"500px"},{footer:a(()=>[s(t(p),{onClick:e[4]||(e[4]=l=>m.value=!1)},{default:a(()=>e[14]||(e[14]=[d("Cancel")])),_:1}),s(t(p),{type:"primary",onClick:P},{default:a(()=>e[15]||(e[15]=[d("Create")])),_:1})]),default:a(()=>[s(t(S),{model:o,"label-width":"120px"},{default:a(()=>[s(t(D),{label:"Username"},{default:a(()=>[s(t(U),{modelValue:o.username,"onUpdate:modelValue":e[1]||(e[1]=l=>o.username=l),placeholder:"Username"},null,8,["modelValue"])]),_:1}),s(t(D),{label:"Password"},{default:a(()=>[s(t(U),{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=l=>o.password=l),type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"])]),_:1}),s(t(D),{label:"Duration (Days)"},{default:a(()=>[s(t(U),{modelValue:o.duration_days,"onUpdate:modelValue":e[3]||(e[3]=l=>o.duration_days=l),modelModifiers:{number:!0},type:"number",placeholder:"30 (0 for unlimited)",style:{width:"100%"}},{append:a(()=>e[12]||(e[12]=[d("days")])),_:1},8,["modelValue"]),e[13]||(e[13]=W("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," Enter number of days (0 = unlimited) ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(t(M),{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),title:"Extend Subscription",width:"400px"},{footer:a(()=>[s(t(p),{onClick:e[7]||(e[7]=l=>f.value=!1)},{default:a(()=>e[16]||(e[16]=[d("Cancel")])),_:1}),s(t(p),{type:"primary",onClick:z},{default:a(()=>e[17]||(e[17]=[d("Extend")])),_:1})]),default:a(()=>[s(t(S),{model:n,"label-width":"120px"},{default:a(()=>[s(t(D),{label:"Days to Extend"},{default:a(()=>[s(t(U),{modelValue:n.days,"onUpdate:modelValue":e[6]||(e[6]=l=>n.days=l),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{ie as default};
