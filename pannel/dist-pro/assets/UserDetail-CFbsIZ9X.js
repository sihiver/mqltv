var $=(B,F,x)=>new Promise((E,l)=>{var k=p=>{try{y(x.next(p))}catch(m){l(m)}},C=p=>{try{y(x.throw(p))}catch(m){l(m)}},y=p=>p.done?E(p.value):Promise.resolve(p.value).then(k,C);y((x=x.apply(B,F)).next())});import{_ as j}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DT9K-ZQh.js";import{I as S,r as I}from"./index-CdpqmSva.js";/* empty css               *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css                  *//* empty css                     */import{j as q,as as K,ar as Y,r as h,e as Z,ac as H,C as v,l as c,D as a,t as u,L as J,A as g,G as t,u as e,_ as r,I as i,k as V,F as O,Z as Q}from"./vue-chunks-B2QQ4E8c.js";import{c as D,n as T,C as N,D as d,s as b,q as W,r as U,t as X,u as ee,v as ae,w as te,b as _,k as le}from"./element-plus-tut8eD11.js";const se={style:{"margin-bottom":"16px"}},ne={key:0},re={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ie={style:{display:"flex","align-items":"center",gap:"8px"}},oe={style:{flex:"1",padding:"8px",background:"#f5f5f5","border-radius":"4px"}},ue={style:{display:"flex","justify-content":"space-between","align-items":"center"}},we=q({__name:"UserDetail",setup(B){const F=K(),x=Y(),E=F.params.id,l=h(null),k=h(!1),C=h([]),y=h(!1),p=h({days:30}),m=()=>$(this,null,function*(){k.value=!0;try{const n=yield I.get({url:`/api/users/${E}`});n&&n.data&&(l.value=n.data,l.value.user&&(l.value.user.disabled=!l.value.user.is_active),n.data.channels&&(C.value=n.data.channels))}catch(n){console.error("Error loading user detail:",n),_.error("Failed to load user details")}finally{k.value=!1}}),M=n=>{navigator.clipboard.writeText(n).then(()=>{_.success("Copied to clipboard!")}).catch(()=>{_.error("Failed to copy")})},L=n=>`${window.location.protocol}//${window.location.host}${n}`,P=n=>{if(!n)return"info";const s=new Date(n),f=new Date;return s<f?"danger":Math.floor((s.getTime()-f.getTime())/(1e3*60*60*24))<=7?"warning":"success"},z=n=>{if(!n)return"No expiry";const s=new Date(n);return s<new Date?"Expired":s.toLocaleDateString()},G=()=>$(this,null,function*(){try{yield I.post({url:`/api/users/${E}/extend`,data:{days:p.value.days}}),_.success("Subscription extended successfully"),y.value=!1,m()}catch(n){_.error("Failed to extend subscription")}}),R=()=>$(this,null,function*(){var w;const n=(w=l.value)==null?void 0:w.user;if(!n)return;const s=n.disabled?"enable":"disable",f=n.disabled?"Enable":"Disable";try{yield le.confirm(`${f} user "${n.username}"?`,`${f} User`,{confirmButtonText:f,cancelButtonText:"Cancel",type:"warning"}),yield I.post({url:`/api/users/${E}/toggle`}),_.success(`User ${s}d successfully`),m()}catch(o){o!=="cancel"&&_.error(`Failed to ${s} user`)}});return Z(()=>{m()}),(n,s)=>{const f=H("loading");return c(),v(e(j),{title:"User Details",message:"View user information, playlist and channels"},{default:a(()=>{var w;return[u("div",se,[t(e(D),{onClick:s[0]||(s[0]=o=>e(x).push("/users/index"))},{default:a(()=>[t(e(S),{icon:"ep:back"}),s[6]||(s[6]=r(" Back to Users "))]),_:1}),t(e(D),{type:"primary",onClick:s[1]||(s[1]=o=>y.value=!0),style:{"margin-left":"8px"}},{default:a(()=>[t(e(S),{icon:"ep:calendar"}),s[7]||(s[7]=r(" Extend Subscription "))]),_:1}),t(e(D),{type:(w=l.value)!=null&&w.user.disabled?"success":"warning",onClick:R,style:{"margin-left":"8px"}},{default:a(()=>{var o,A;return[t(e(S),{icon:(o=l.value)!=null&&o.user.disabled?"ep:check":"ep:close"},null,8,["icon"]),r(" "+i((A=l.value)!=null&&A.user.disabled?"Enable User":"Disable User"),1)]}),_:1},8,["type"])]),l.value?J((c(),V("div",ne,[t(e(T),{style:{"margin-bottom":"16px"}},{header:a(()=>[u("div",re,[s[8]||(s[8]=u("span",null,[u("strong",null,"User Information")],-1)),t(e(b),{type:P(l.value.user.expires_at)},{default:a(()=>[r(i(z(l.value.user.expires_at)),1)]),_:1},8,["type"])])]),default:a(()=>[t(e(N),{column:2,border:""},{default:a(()=>[t(e(d),{label:"Username"},{default:a(()=>[r(i(l.value.user.username),1)]),_:1}),t(e(d),{label:"User ID"},{default:a(()=>[r(i(l.value.user.id),1)]),_:1}),t(e(d),{label:"Password"},{default:a(()=>[r(i(l.value.user.password),1)]),_:1}),t(e(d),{label:"Max Connections"},{default:a(()=>[r(i(l.value.user.max_connections),1)]),_:1}),t(e(d),{label:"Expiry Date"},{default:a(()=>[r(i(l.value.user.expires_at?new Date(l.value.user.expires_at).toLocaleString():"No expiry set"),1)]),_:1}),t(e(d),{label:"Created At"},{default:a(()=>[r(i(new Date(l.value.user.created_at).toLocaleString()),1)]),_:1}),l.value.user.expires_at?(c(),v(e(d),{key:0,label:"Days Remaining"},{default:a(()=>[t(e(b),{type:l.value.user.days_remaining<0?"danger":"success"},{default:a(()=>[r(i(l.value.user.days_remaining)+" days ",1)]),_:1},8,["type"])]),_:1})):g("",!0),t(e(d),{label:"Status"},{default:a(()=>[t(e(b),{type:l.value.user.is_active?"success":"danger"},{default:a(()=>[r(i(l.value.user.is_active?"Active":"Inactive"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),t(e(T),{style:{"margin-bottom":"16px"}},{header:a(()=>s[9]||(s[9]=[u("span",null,[u("strong",null,"Playlist Information")],-1)])),default:a(()=>[t(e(N),{column:1,border:""},{default:a(()=>[t(e(d),{label:"Status"},{default:a(()=>[t(e(b),{type:l.value.playlist.generated?"success":"warning"},{default:a(()=>[r(i(l.value.playlist.generated?"Generated":"Not Generated Yet"),1)]),_:1},8,["type"])]),_:1}),l.value.playlist.generated?(c(),v(e(d),{key:0,label:"Playlist URL"},{default:a(()=>[u("div",ie,[u("code",oe,i(L(l.value.playlist.url)),1),t(e(D),{type:"primary",size:"small",onClick:s[2]||(s[2]=o=>M(L(l.value.playlist.url)))},{default:a(()=>[t(e(S),{icon:"ep:document-copy"}),s[10]||(s[10]=r(" Copy "))]),_:1})])]),_:1})):g("",!0),l.value.playlist.generated?(c(),v(e(d),{key:1,label:"Filename"},{default:a(()=>[r(i(l.value.playlist.filename),1)]),_:1})):g("",!0),l.value.playlist.generated?(c(),v(e(d),{key:2,label:"File Size"},{default:a(()=>[r(i(Math.round(l.value.playlist.size/1024))+" KB ",1)]),_:1})):g("",!0),l.value.playlist.generated?(c(),v(e(d),{key:3,label:"Generated At"},{default:a(()=>[r(i(new Date(l.value.playlist.generated_at).toLocaleString()),1)]),_:1})):g("",!0),t(e(d),{label:"Total Active Channels"},{default:a(()=>[t(e(b),{type:"primary"},{default:a(()=>[r(i(l.value.total_channels)+" channels",1)]),_:1})]),_:1})]),_:1})]),_:1}),l.value.playlist.available_playlists?(c(),v(e(T),{key:0,style:{"margin-bottom":"16px"}},{header:a(()=>s[11]||(s[11]=[u("span",null,[u("strong",null,"Available Playlists")],-1)])),default:a(()=>[(c(!0),V(O,null,Q(l.value.playlist.available_playlists,o=>(c(),V("div",{key:o.id,style:{"margin-bottom":"12px",padding:"12px",background:"#f5f5f5","border-radius":"4px"}},[u("div",ue,[u("div",null,[u("strong",null,i(o.name),1)]),t(e(b),{type:"info"},{default:a(()=>[r(i(o.channel_count)+" channels",1)]),_:2},1024)])]))),128))]),_:1})):g("",!0),t(e(T),null,{header:a(()=>[u("span",null,[u("strong",null,"Available Channels ("+i(C.value.length)+")",1)])]),default:a(()=>[t(e(W),{data:C.value,style:{width:"100%"},"max-height":"600"},{default:a(()=>[t(e(U),{type:"index",label:"#",width:"60"}),t(e(U),{prop:"name",label:"Channel Name","min-width":"200"}),t(e(U),{prop:"playlist_name",label:"Playlist",width:"180"}),t(e(U),{prop:"category",label:"Category",width:"150"}),t(e(U),{label:"Status",width:"100"},{default:a(({row:o})=>[t(e(b),{type:o.enabled?"success":"danger",size:"small"},{default:a(()=>[r(i(o.enabled?"Active":"Inactive"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})])),[[f,k.value]]):g("",!0),t(e(X),{modelValue:y.value,"onUpdate:modelValue":s[5]||(s[5]=o=>y.value=o),title:"Extend Subscription",width:"400px"},{footer:a(()=>[t(e(D),{onClick:s[4]||(s[4]=o=>y.value=!1)},{default:a(()=>s[12]||(s[12]=[r("Cancel")])),_:1}),t(e(D),{type:"primary",onClick:G},{default:a(()=>s[13]||(s[13]=[r("Extend")])),_:1})]),default:a(()=>[t(e(ee),{model:p.value,"label-width":"120px"},{default:a(()=>[t(e(ae),{label:"Days to Extend"},{default:a(()=>[t(e(te),{modelValue:p.value.days,"onUpdate:modelValue":s[3]||(s[3]=o=>p.value.days=o),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]}),_:1})}}});export{we as default};
