var y=(N,h,n)=>new Promise((m,f)=>{var p=d=>{try{V(n.next(d))}catch(P){f(P)}},g=d=>{try{V(n.throw(d))}catch(P){f(P)}},V=d=>d.done?m(d.value):Promise.resolve(d.value).then(p,g);V((n=n.apply(N,h)).next())});import{_ as O}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C2ZlXlGE.js";import{a as q,I as v,r as b,_ as K}from"./index-edGwmMvL.js";/* empty css               *//* empty css                     *//* empty css                   *//* empty css               */import{l as Q,m as F,n as U,u as E,v as r,w,D as x,F as C,c,G as Y,s as k,b as i}from"./element-plus-B47XQz09.js";import{j as $,r as S,e as J,ac as W,C as I,l as T,D as t,G as l,u as e,L as D,_,t as u}from"./vue-chunks-B2QQ4E8c.js";/* empty css                  */const X={style:{display:"flex","align-items":"center",gap:"8px"}},Z={style:{display:"flex","align-items":"center",gap:"8px"}},ee={style:{display:"flex",gap:"8px"}},le={style:{display:"flex","align-items":"center",gap:"8px"}},ae={style:{display:"flex","align-items":"center",gap:"8px"}},te={style:{padding:"20px"}},se={style:{display:"flex",gap:"8px","align-items":"center"}},oe={style:{display:"flex","flex-direction":"column",gap:"8px"}},re={style:{display:"flex","justify-content":"space-between"}},ue={style:{display:"flex","justify-content":"space-between"}},ne={style:{display:"flex","justify-content":"space-between"}},de={style:{display:"flex","justify-content":"space-between"}},ie={style:{display:"flex","align-items":"center",gap:"8px"}},me={style:{display:"flex","align-items":"center",gap:"8px"}},pe=$({__name:"Settings",setup(N){const h=q(),n=S({server_name:"IPTV Panel",server_url:"http://localhost:8080",max_connections_per_user:3,session_timeout:3600,enable_user_registration:!1,enable_relay_mode:!0}),m=S({ffmpeg_path:"/usr/bin/ffmpeg",buffer_size:2048,idle_timeout:60,max_streams:100,enable_hls:!0,hls_segment_duration:6}),f=S({auto_start:!0,auto_stop:!0,max_bitrate:8e3,enable_transcode:!1,default_format:"mpegts"}),p=S({current_password:"",new_password:"",confirm_password:""}),g=S({username:"",full_name:"",email:""}),V=S(!1),d=S(!1),P=()=>y(this,null,function*(){V.value=!0;try{const o=yield b.get({url:"/api/settings"});o&&o.data&&(o.data.system&&(Object.assign(n.value,o.data.system),o.data.system.server_name&&h.setTitle(o.data.system.server_name)),o.data.ffmpeg&&Object.assign(m.value,o.data.ffmpeg),o.data.stream&&Object.assign(f.value,o.data.stream))}catch(o){console.error("Error loading settings:",o),i.error("Failed to load settings")}finally{V.value=!1}}),B=()=>y(this,null,function*(){d.value=!0;try{yield b.post({url:"/api/settings",data:{category:"system",settings:n.value}}),n.value.server_name&&(h.setTitle(n.value.server_name),localStorage.setItem("app_title",n.value.server_name)),i.success("System settings saved successfully")}catch(o){i.error("Failed to save system settings")}finally{d.value=!1}}),L=()=>y(this,null,function*(){d.value=!0;try{yield b.post({url:"/api/settings",data:{category:"ffmpeg",settings:m.value}}),i.success("FFmpeg settings saved successfully")}catch(o){i.error("Failed to save FFmpeg settings")}finally{d.value=!1}}),M=()=>y(this,null,function*(){d.value=!0;try{yield b.post({url:"/api/settings",data:{category:"stream",settings:f.value}}),i.success("Stream settings saved successfully")}catch(o){i.error("Failed to save stream settings")}finally{d.value=!1}}),A=()=>y(this,null,function*(){try{i.info("Testing FFmpeg...");const o=yield b.post({url:"/api/settings/test-ffmpeg"});o&&o.data&&i.success("FFmpeg is working correctly")}catch(o){i.error("FFmpeg test failed")}}),z=()=>y(this,null,function*(){try{yield b.post({url:"/api/settings/clear-cache"}),i.success("Cache cleared successfully")}catch(o){i.error("Failed to clear cache")}}),R=()=>y(this,null,function*(){try{const o=yield b.get({url:"/api/auth/profile"});o&&o.data&&(g.value={username:o.data.username||"",full_name:o.data.full_name||"",email:o.data.email||""})}catch(o){console.error("Error loading profile:",o)}}),H=()=>y(this,null,function*(){if(!p.value.current_password||!p.value.new_password){i.warning("Please fill all password fields");return}if(p.value.new_password!==p.value.confirm_password){i.error("New passwords do not match");return}if(p.value.new_password.length<6){i.error("Password must be at least 6 characters");return}d.value=!0;try{yield b.post({url:"/api/auth/change-password",data:{old_password:p.value.current_password,new_password:p.value.new_password}}),i.success("Password changed successfully"),p.value={current_password:"",new_password:"",confirm_password:""}}catch(o){i.error(o.message||"Failed to change password")}finally{d.value=!1}}),G=()=>y(this,null,function*(){if(!g.value.username){i.warning("Username is required");return}d.value=!0;try{yield b.post({url:"/api/auth/update-profile",data:g.value}),i.success("Profile updated successfully")}catch(o){i.error("Failed to update profile")}finally{d.value=!1}});return J(()=>{P(),R()}),(o,a)=>{const j=W("loading");return T(),I(e(O),{title:"Settings",message:"Configure system settings and preferences"},{default:t(()=>[l(e(Q),{gutter:20},{default:t(()=>[l(e(F),{xs:24,sm:24,md:12},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",X,[l(e(v),{icon:"ep:setting"}),a[23]||(a[23]=u("span",null,"System Settings",-1))])]),default:t(()=>[D((T(),I(e(E),{model:n.value,"label-width":"200px"},{default:t(()=>[l(e(r),{label:"Server Name"},{default:t(()=>[l(e(w),{modelValue:n.value.server_name,"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.server_name=s),placeholder:"IPTV Panel"},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Server URL"},{default:t(()=>[l(e(w),{modelValue:n.value.server_url,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.server_url=s),placeholder:"http://localhost:8080"},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Max Connections/User"},{default:t(()=>[l(e(x),{modelValue:n.value.max_connections_per_user,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value.max_connections_per_user=s),min:1,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Session Timeout (seconds)"},{default:t(()=>[l(e(x),{modelValue:n.value.session_timeout,"onUpdate:modelValue":a[3]||(a[3]=s=>n.value.session_timeout=s),min:300,max:86400,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"User Registration"},{default:t(()=>[l(e(C),{modelValue:n.value.enable_user_registration,"onUpdate:modelValue":a[4]||(a[4]=s=>n.value.enable_user_registration=s)},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Relay Mode"},{default:t(()=>[l(e(C),{modelValue:n.value.enable_relay_mode,"onUpdate:modelValue":a[5]||(a[5]=s=>n.value.enable_relay_mode=s)},null,8,["modelValue"])]),_:1}),l(e(r),null,{default:t(()=>[l(e(c),{type:"primary",onClick:B,loading:d.value},{default:t(()=>[l(e(v),{icon:"ep:upload"}),a[24]||(a[24]=_(" Save System Settings "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[j,V.value]])]),_:1})]),_:1}),l(e(F),{xs:24,sm:24,md:12},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",Z,[l(e(v),{icon:"ep:video-camera"}),a[25]||(a[25]=u("span",null,"FFmpeg Settings",-1))])]),default:t(()=>[D((T(),I(e(E),{model:m.value,"label-width":"200px"},{default:t(()=>[l(e(r),{label:"FFmpeg Path"},{default:t(()=>[l(e(w),{modelValue:m.value.ffmpeg_path,"onUpdate:modelValue":a[6]||(a[6]=s=>m.value.ffmpeg_path=s),placeholder:"/usr/bin/ffmpeg"},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Buffer Size (KB)"},{default:t(()=>[l(e(x),{modelValue:m.value.buffer_size,"onUpdate:modelValue":a[7]||(a[7]=s=>m.value.buffer_size=s),min:512,max:10240,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Idle Timeout (seconds)"},{default:t(()=>[l(e(x),{modelValue:m.value.idle_timeout,"onUpdate:modelValue":a[8]||(a[8]=s=>m.value.idle_timeout=s),min:30,max:300,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Max Concurrent Streams"},{default:t(()=>[l(e(x),{modelValue:m.value.max_streams,"onUpdate:modelValue":a[9]||(a[9]=s=>m.value.max_streams=s),min:10,max:500,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Enable HLS"},{default:t(()=>[l(e(C),{modelValue:m.value.enable_hls,"onUpdate:modelValue":a[10]||(a[10]=s=>m.value.enable_hls=s)},null,8,["modelValue"])]),_:1}),l(e(r),{label:"HLS Segment Duration (s)"},{default:t(()=>[l(e(x),{modelValue:m.value.hls_segment_duration,"onUpdate:modelValue":a[11]||(a[11]=s=>m.value.hls_segment_duration=s),min:2,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),null,{default:t(()=>[u("div",ee,[l(e(c),{type:"primary",onClick:L,loading:d.value},{default:t(()=>[l(e(v),{icon:"ep:upload"}),a[26]||(a[26]=_(" Save FFmpeg Settings "))]),_:1},8,["loading"]),l(e(c),{onClick:A},{default:t(()=>[l(e(v),{icon:"ep:video-play"}),a[27]||(a[27]=_(" Test FFmpeg "))]),_:1})])]),_:1})]),_:1},8,["model"])),[[j,V.value]])]),_:1})]),_:1}),l(e(F),{xs:24,sm:24,md:12,style:{"margin-top":"20px"}},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",le,[l(e(v),{icon:"ep:video-play"}),a[28]||(a[28]=u("span",null,"Stream Settings",-1))])]),default:t(()=>[D((T(),I(e(E),{model:f.value,"label-width":"200px"},{default:t(()=>[l(e(r),{label:"Auto Start Streams"},{default:t(()=>[l(e(C),{modelValue:f.value.auto_start,"onUpdate:modelValue":a[12]||(a[12]=s=>f.value.auto_start=s)},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Auto Stop Idle Streams"},{default:t(()=>[l(e(C),{modelValue:f.value.auto_stop,"onUpdate:modelValue":a[13]||(a[13]=s=>f.value.auto_stop=s)},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Max Bitrate (kbps)"},{default:t(()=>[l(e(x),{modelValue:f.value.max_bitrate,"onUpdate:modelValue":a[14]||(a[14]=s=>f.value.max_bitrate=s),min:1e3,max:2e4,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Enable Transcode"},{default:t(()=>[l(e(C),{modelValue:f.value.enable_transcode,"onUpdate:modelValue":a[15]||(a[15]=s=>f.value.enable_transcode=s)},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Default Format"},{default:t(()=>[l(e(w),{modelValue:f.value.default_format,"onUpdate:modelValue":a[16]||(a[16]=s=>f.value.default_format=s),placeholder:"mpegts"},null,8,["modelValue"])]),_:1}),l(e(r),null,{default:t(()=>[l(e(c),{type:"primary",onClick:M,loading:d.value},{default:t(()=>[l(e(v),{icon:"ep:upload"}),a[29]||(a[29]=_(" Save Stream Settings "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[j,V.value]])]),_:1})]),_:1}),l(e(F),{xs:24,sm:24,md:12,style:{"margin-top":"20px"}},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",ae,[l(e(v),{icon:"ep:tools"}),a[30]||(a[30]=u("span",null,"System Actions",-1))])]),default:t(()=>[u("div",te,[l(e(r),{label:"Cache Management"},{default:t(()=>[u("div",se,[l(e(c),{onClick:z},{default:t(()=>[l(e(v),{icon:"ep:delete"}),a[31]||(a[31]=_(" Clear HLS Cache "))]),_:1}),a[32]||(a[32]=u("span",{style:{color:"#909399","font-size":"12px"}}," Clear all cached HLS segments ",-1))])]),_:1}),l(e(Y)),l(e(r),{label:"System Information"},{default:t(()=>[u("div",oe,[u("div",re,[a[34]||(a[34]=u("span",null,"Version:",-1)),l(e(k),null,{default:t(()=>a[33]||(a[33]=[_("v1.0.0")])),_:1})]),u("div",ue,[a[36]||(a[36]=u("span",null,"Go Version:",-1)),l(e(k),{type:"success"},{default:t(()=>a[35]||(a[35]=[_("1.21+")])),_:1})]),u("div",ne,[a[38]||(a[38]=u("span",null,"Database:",-1)),l(e(k),{type:"info"},{default:t(()=>a[37]||(a[37]=[_("SQLite")])),_:1})]),u("div",de,[a[40]||(a[40]=u("span",null,"FFmpeg:",-1)),l(e(k),{type:"warning"},{default:t(()=>a[39]||(a[39]=[_("Installed")])),_:1})])])]),_:1})])]),_:1})]),_:1}),l(e(F),{xs:24,sm:24,md:12,style:{"margin-top":"20px"}},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",ie,[l(e(v),{icon:"ep:lock"}),a[41]||(a[41]=u("span",null,"Change Password",-1))])]),default:t(()=>[l(e(E),{model:p.value,"label-width":"200px"},{default:t(()=>[l(e(r),{label:"Current Password"},{default:t(()=>[l(e(w),{modelValue:p.value.current_password,"onUpdate:modelValue":a[17]||(a[17]=s=>p.value.current_password=s),type:"password",placeholder:"Enter current password","show-password":""},null,8,["modelValue"])]),_:1}),l(e(r),{label:"New Password"},{default:t(()=>[l(e(w),{modelValue:p.value.new_password,"onUpdate:modelValue":a[18]||(a[18]=s=>p.value.new_password=s),type:"password",placeholder:"At least 6 characters","show-password":""},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Confirm Password"},{default:t(()=>[l(e(w),{modelValue:p.value.confirm_password,"onUpdate:modelValue":a[19]||(a[19]=s=>p.value.confirm_password=s),type:"password",placeholder:"Re-enter new password","show-password":""},null,8,["modelValue"])]),_:1}),l(e(r),null,{default:t(()=>[l(e(c),{type:"primary",onClick:H,loading:d.value},{default:t(()=>[l(e(v),{icon:"ep:check"}),a[42]||(a[42]=_(" Change Password "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),l(e(F),{xs:24,sm:24,md:12,style:{"margin-top":"20px"}},{default:t(()=>[l(e(U),{shadow:"hover"},{header:t(()=>[u("div",me,[l(e(v),{icon:"ep:user"}),a[43]||(a[43]=u("span",null,"Profile Settings",-1))])]),default:t(()=>[l(e(E),{model:g.value,"label-width":"200px"},{default:t(()=>[l(e(r),{label:"Username"},{default:t(()=>[l(e(w),{modelValue:g.value.username,"onUpdate:modelValue":a[20]||(a[20]=s=>g.value.username=s),placeholder:"Admin username",disabled:""},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Full Name"},{default:t(()=>[l(e(w),{modelValue:g.value.full_name,"onUpdate:modelValue":a[21]||(a[21]=s=>g.value.full_name=s),placeholder:"Your full name"},null,8,["modelValue"])]),_:1}),l(e(r),{label:"Email"},{default:t(()=>[l(e(w),{modelValue:g.value.email,"onUpdate:modelValue":a[22]||(a[22]=s=>g.value.email=s),placeholder:"your.email@example.com"},null,8,["modelValue"])]),_:1}),l(e(r),null,{default:t(()=>[l(e(c),{type:"primary",onClick:G,loading:d.value},{default:t(()=>[l(e(v),{icon:"ep:upload"}),a[44]||(a[44]=_(" Update Profile "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Se=K(pe,[["__scopeId","data-v-964bbcf0"]]);export{Se as default};
