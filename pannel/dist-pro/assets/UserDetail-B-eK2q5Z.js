var S=(P,T,_)=>new Promise((w,s)=>{var D=p=>{try{c(_.next(p))}catch(f){s(f)}},E=p=>{try{c(_.throw(p))}catch(f){s(f)}},c=p=>p.done?w(p.value):Promise.resolve(p.value).then(D,E);c((_=_.apply(P,T)).next())});import{_ as z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C3jeulgB.js";import{I as F,r as $}from"./index-DTPVUMgb.js";/* empty css               *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css                  *//* empty css                     */import{j as G,as as j,ar as q,r as C,e as K,ac as Y,C as m,l as y,D as t,t as u,L as Z,A as v,G as a,u as e,_ as n,k as B,I as o,F as H,Z as J}from"./vue-chunks-B2QQ4E8c.js";import{c as x,n as I,A as V,B as d,s as g,q as O,r as h,t as Q,u as W,v as X,w as ee,b,k as te}from"./element-plus-B47XQz09.js";const ae={style:{"margin-bottom":"16px"}},le={key:0},se={style:{display:"flex","justify-content":"space-between","align-items":"center"}},re={style:{display:"flex","align-items":"center",gap:"8px"}},ne={style:{flex:"1",padding:"8px",background:"#f5f5f5","border-radius":"4px"}},oe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},_e=G({__name:"UserDetail",setup(P){const T=j(),_=q(),w=T.params.id,s=C(null),D=C(!1),E=C([]),c=C(!1),p=C({days:30}),f=()=>S(this,null,function*(){D.value=!0;try{const r=yield $.get({url:`/api/users/${w}`});r&&r.data&&(s.value=r.data,r.data.channels&&(E.value=r.data.channels))}catch(r){console.error("Error loading user detail:",r),b.error("Failed to load user details")}finally{D.value=!1}}),A=r=>{navigator.clipboard.writeText(r).then(()=>{b.success("Copied to clipboard!")}).catch(()=>{b.error("Failed to copy")})},U=r=>`${window.location.protocol}//${window.location.host}${r}`,L=r=>{if(!r)return"info";const l=new Date(r),k=new Date;return l<k?"danger":Math.floor((l.getTime()-k.getTime())/(1e3*60*60*24))<=7?"warning":"success"},M=r=>{if(!r)return"No expiry";const l=new Date(r);return l<new Date?"Expired":l.toLocaleDateString()},N=()=>S(this,null,function*(){try{yield $.post({url:`/api/users/${w}/extend`,data:{days:p.value.days}}),b.success("Subscription extended successfully"),c.value=!1,f()}catch(r){b.error("Failed to extend subscription")}}),R=()=>S(this,null,function*(){var r;try{const l=yield te.prompt(`Enter new password for user "${(r=s.value)==null?void 0:r.user.username}"`,"Reset Password",{confirmButtonText:"Reset",cancelButtonText:"Cancel",inputPattern:/.+/,inputErrorMessage:"Password is required"});yield $.post({url:`/api/users/${w}/reset-password`,data:{password:l.value}}),b.success("Password reset successfully"),f()}catch(l){l!=="cancel"&&b.error("Failed to reset password")}});return K(()=>{f()}),(r,l)=>{const k=Y("loading");return y(),m(e(z),{title:"User Details",message:"View user information, playlist and channels"},{default:t(()=>[u("div",ae,[a(e(x),{onClick:l[0]||(l[0]=i=>e(_).push("/users/index"))},{default:t(()=>[a(e(F),{icon:"ep:back"}),l[6]||(l[6]=n(" Back to Users "))]),_:1}),a(e(x),{type:"primary",onClick:l[1]||(l[1]=i=>c.value=!0),style:{"margin-left":"8px"}},{default:t(()=>[a(e(F),{icon:"ep:calendar"}),l[7]||(l[7]=n(" Extend Subscription "))]),_:1}),a(e(x),{type:"warning",onClick:R,style:{"margin-left":"8px"}},{default:t(()=>[a(e(F),{icon:"ep:lock"}),l[8]||(l[8]=n(" Reset Password "))]),_:1})]),s.value?Z((y(),B("div",le,[a(e(I),{style:{"margin-bottom":"16px"}},{header:t(()=>[u("div",se,[l[9]||(l[9]=u("span",null,[u("strong",null,"User Information")],-1)),a(e(g),{type:L(s.value.user.expires_at)},{default:t(()=>[n(o(M(s.value.user.expires_at)),1)]),_:1},8,["type"])])]),default:t(()=>[a(e(V),{column:2,border:""},{default:t(()=>[a(e(d),{label:"Username"},{default:t(()=>[n(o(s.value.user.username),1)]),_:1}),a(e(d),{label:"User ID"},{default:t(()=>[n(o(s.value.user.id),1)]),_:1}),a(e(d),{label:"Password"},{default:t(()=>[n(o(s.value.user.password),1)]),_:1}),a(e(d),{label:"Max Connections"},{default:t(()=>[n(o(s.value.user.max_connections),1)]),_:1}),a(e(d),{label:"Expiry Date"},{default:t(()=>[n(o(s.value.user.expires_at?new Date(s.value.user.expires_at).toLocaleString():"No expiry set"),1)]),_:1}),a(e(d),{label:"Created At"},{default:t(()=>[n(o(new Date(s.value.user.created_at).toLocaleString()),1)]),_:1}),s.value.user.expires_at?(y(),m(e(d),{key:0,label:"Days Remaining"},{default:t(()=>[a(e(g),{type:s.value.user.days_remaining<0?"danger":"success"},{default:t(()=>[n(o(s.value.user.days_remaining)+" days ",1)]),_:1},8,["type"])]),_:1})):v("",!0),a(e(d),{label:"Status"},{default:t(()=>[a(e(g),{type:s.value.user.is_active?"success":"danger"},{default:t(()=>[n(o(s.value.user.is_active?"Active":"Inactive"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),a(e(I),{style:{"margin-bottom":"16px"}},{header:t(()=>l[10]||(l[10]=[u("span",null,[u("strong",null,"Playlist Information")],-1)])),default:t(()=>[a(e(V),{column:1,border:""},{default:t(()=>[a(e(d),{label:"Status"},{default:t(()=>[a(e(g),{type:s.value.playlist.generated?"success":"warning"},{default:t(()=>[n(o(s.value.playlist.generated?"Generated":"Not Generated Yet"),1)]),_:1},8,["type"])]),_:1}),s.value.playlist.generated?(y(),m(e(d),{key:0,label:"Playlist URL"},{default:t(()=>[u("div",re,[u("code",ne,o(U(s.value.playlist.url)),1),a(e(x),{type:"primary",size:"small",onClick:l[2]||(l[2]=i=>A(U(s.value.playlist.url)))},{default:t(()=>[a(e(F),{icon:"ep:document-copy"}),l[11]||(l[11]=n(" Copy "))]),_:1})])]),_:1})):v("",!0),s.value.playlist.generated?(y(),m(e(d),{key:1,label:"Filename"},{default:t(()=>[n(o(s.value.playlist.filename),1)]),_:1})):v("",!0),s.value.playlist.generated?(y(),m(e(d),{key:2,label:"File Size"},{default:t(()=>[n(o(Math.round(s.value.playlist.size/1024))+" KB ",1)]),_:1})):v("",!0),s.value.playlist.generated?(y(),m(e(d),{key:3,label:"Generated At"},{default:t(()=>[n(o(new Date(s.value.playlist.generated_at).toLocaleString()),1)]),_:1})):v("",!0),a(e(d),{label:"Total Active Channels"},{default:t(()=>[a(e(g),{type:"primary"},{default:t(()=>[n(o(s.value.total_channels)+" channels",1)]),_:1})]),_:1})]),_:1})]),_:1}),s.value.playlist.available_playlists?(y(),m(e(I),{key:0,style:{"margin-bottom":"16px"}},{header:t(()=>l[12]||(l[12]=[u("span",null,[u("strong",null,"Available Playlists")],-1)])),default:t(()=>[(y(!0),B(H,null,J(s.value.playlist.available_playlists,i=>(y(),B("div",{key:i.id,style:{"margin-bottom":"12px",padding:"12px",background:"#f5f5f5","border-radius":"4px"}},[u("div",oe,[u("div",null,[u("strong",null,o(i.name),1)]),a(e(g),{type:"info"},{default:t(()=>[n(o(i.channel_count)+" channels",1)]),_:2},1024)])]))),128))]),_:1})):v("",!0),a(e(I),null,{header:t(()=>[u("span",null,[u("strong",null,"Available Channels ("+o(E.value.length)+")",1)])]),default:t(()=>[a(e(O),{data:E.value,style:{width:"100%"},"max-height":"600"},{default:t(()=>[a(e(h),{type:"index",label:"#",width:"60"}),a(e(h),{prop:"name",label:"Channel Name","min-width":"200"}),a(e(h),{prop:"playlist_name",label:"Playlist",width:"180"}),a(e(h),{prop:"category",label:"Category",width:"150"}),a(e(h),{label:"Status",width:"100"},{default:t(({row:i})=>[a(e(g),{type:i.enabled?"success":"danger",size:"small"},{default:t(()=>[n(o(i.enabled?"Active":"Inactive"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})])),[[k,D.value]]):v("",!0),a(e(Q),{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=i=>c.value=i),title:"Extend Subscription",width:"400px"},{footer:t(()=>[a(e(x),{onClick:l[4]||(l[4]=i=>c.value=!1)},{default:t(()=>l[13]||(l[13]=[n("Cancel")])),_:1}),a(e(x),{type:"primary",onClick:N},{default:t(()=>l[14]||(l[14]=[n("Extend")])),_:1})]),default:t(()=>[a(e(W),{model:p.value,"label-width":"120px"},{default:t(()=>[a(e(X),{label:"Days to Extend"},{default:t(()=>[a(e(ee),{modelValue:p.value.days,"onUpdate:modelValue":l[3]||(l[3]=i=>p.value.days=i),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{_e as default};
