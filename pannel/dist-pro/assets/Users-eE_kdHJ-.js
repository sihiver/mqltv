var te=Object.defineProperty,ae=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var P=(m,d,i)=>d in m?te(m,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[d]=i,N=(m,d)=>{for(var i in d||(d={}))se.call(d,i)&&P(m,i,d[i]);if(q)for(var i of q(d))re.call(d,i)&&P(m,i,d[i]);return m},z=(m,d)=>ae(m,le(d));var v=(m,d,i)=>new Promise((U,w)=>{var b=n=>{try{f(i.next(n))}catch(y){w(y)}},g=n=>{try{f(i.throw(n))}catch(y){w(y)}},f=n=>n.done?U(n.value):Promise.resolve(n.value).then(b,g);f((i=i.apply(m,d)).next())});import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DT9K-ZQh.js";import{e as E,r as C}from"./index-CdpqmSva.js";/* empty css                        *//* empty css                    *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                       */import{j as ne,ar as oe,r as k,N as A,e as de,ac as ue,C as O,l as _,D as s,G as r,L as pe,u as l,_ as o,I as V,k as R,t as j}from"./vue-chunks-B2QQ4E8c.js";import{c as p,q as me,r as S,s as fe,t as M,u as I,v as T,w as B,B as ce,b as u,k as F}from"./element-plus-tut8eD11.js";const ye={key:0},xe={key:1},Te=ne({__name:"Users",setup(m){const d=oe(),i=k([]),U=k(!1),w=k(!1),b=k(!1),g=k(!1),f=k(null),n=A({username:"",password:"",duration_days:30}),y=A({days:30}),D=A({expiresAt:new Date(Date.now()-24*60*60*1e3)}),$=()=>v(this,null,function*(){U.value=!0;try{const a=yield C.get({url:"/api/users"});a&&a.data&&(i.value=a.data.map(e=>z(N({},e),{disabled:!e.is_active})))}catch(a){console.error("Error loading users:",a),u.error("Failed to load users")}finally{U.value=!1}}),G=()=>v(this,null,function*(){if(!n.username||!n.password){u.warning("Username and password are required");return}try{const a=yield C.post({url:"/api/users",data:n});a&&a.data&&i.value.unshift(z(N({},a.data),{disabled:!a.data.is_active})),u.success("User created successfully"),w.value=!1,n.username="",n.password="",n.duration_days=30}catch(a){u.error("Failed to create user")}}),H=a=>v(this,null,function*(){try{yield F.confirm(`Delete user "${a.username}"?`,"Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),yield C.delete({url:`/api/users/${a.id}`}),i.value=i.value.filter(e=>e.id!==a.id),u.success("User deleted successfully")}catch(e){e!=="cancel"&&u.error("Failed to delete user")}}),J=a=>{f.value=a,y.days=30,b.value=!0},K=a=>{if(f.value=a,a!=null&&a.expires_at){const e=new Date(a.expires_at);D.expiresAt=isNaN(e.getTime())?new Date(Date.now()-24*60*60*1e3):e}else D.expiresAt=new Date(Date.now()-24*60*60*1e3);g.value=!0},Q=a=>v(this,null,function*(){try{yield F.confirm(`Set user "${a.username}" as expired now?`,"Confirm",{confirmButtonText:"Set Expired",cancelButtonText:"Cancel",type:"warning"});const e=new Date(Date.now()-60*1e3);yield C.post({url:`/api/users/${a.id}/set-expired`,data:{expires_at:e.toISOString()}}),u.success("User marked as expired"),$()}catch(e){e!=="cancel"&&u.error("Failed to set expired")}}),W=()=>v(this,null,function*(){if(f.value)try{yield C.post({url:`/api/users/${f.value.id}/set-expired`,data:{expires_at:D.expiresAt.toISOString()}}),u.success("Expiry updated"),g.value=!1,$()}catch(a){u.error("Failed to update expiry")}}),L=(a,e=!1)=>v(this,null,function*(){try{yield F.confirm(`Clear expiry for user "${a.username}" (set unlimited)?`,"Confirm",{confirmButtonText:"Clear Expiry",cancelButtonText:"Cancel",type:"warning"}),yield C.post({url:`/api/users/${a.id}/set-expired`,data:{clear:!0}}),u.success("Expiry cleared (unlimited)"),e&&(g.value=!1),$()}catch(c){c!=="cancel"&&u.error("Failed to clear expiry")}}),X=()=>v(this,null,function*(){if(f.value)try{yield C.post({url:`/api/users/${f.value.id}/extend`,data:{days:y.days}}),u.success("Subscription extended successfully"),b.value=!1,$()}catch(a){u.error("Failed to extend subscription")}}),Y=a=>v(this,null,function*(){const e=a.disabled?"enable":"disable",c=a.disabled?"Enable":"Disable";try{yield F.confirm(`${c} user "${a.username}"?`,`${c} User`,{confirmButtonText:c,cancelButtonText:"Cancel",type:"warning"});const t=yield C.post({url:`/api/users/${a.id}/toggle`});t&&t.data&&(a.is_active=t.data.is_active,a.disabled=!t.data.is_active),u.success(`User ${e}d successfully`)}catch(t){t!=="cancel"&&u.error(`Failed to ${e} user`)}}),Z=a=>{if(!a)return"info";const e=new Date(a),c=new Date;return e<c?"danger":Math.floor((e.getTime()-c.getTime())/(1e3*60*60*24))<=7?"warning":"success"},h=a=>{if(!a)return"No expiry";const e=new Date(a);return e<new Date?"Expired":e.toLocaleDateString()},ee=a=>{d.push(`/users/detail/${a.id}`)};return de(()=>{$()}),(a,e)=>{const c=ue("loading");return _(),O(l(ie),{title:"Users",message:"Manage user accounts and subscriptions"},{default:s(()=>[r(l(p),{type:"primary",onClick:e[0]||(e[0]=t=>w.value=!0),style:{"margin-bottom":"16px"}},{icon:s(()=>[r(l(E),{icon:"ep:plus"})]),default:s(()=>[e[13]||(e[13]=o(" Create New User "))]),_:1}),pe((_(),O(l(me),{data:i.value,style:{width:"100%"}},{default:s(()=>[r(l(S),{prop:"username",label:"Username","min-width":"150"},{default:s(({row:t})=>[r(l(p),{type:"primary",text:"",onClick:x=>ee(t),style:{padding:"0"}},{default:s(()=>[o(V(t.username),1)]),_:2},1032,["onClick"])]),_:1}),r(l(S),{label:"Status",width:"120"},{default:s(({row:t})=>[r(l(fe),{type:Z(t.expires_at)},{default:s(()=>[o(V(h(t.expires_at)),1)]),_:2},1032,["type"])]),_:1}),r(l(S),{label:"Days Remaining",width:"140"},{default:s(({row:t})=>{var x;return[t!=null&&t.is_expired?(_(),R("span",ye,"Expired")):(_(),R("span",xe,V((x=t==null?void 0:t.days_remaining)!=null?x:"-"),1))]}),_:1}),r(l(S),{prop:"created_at",label:"Created",width:"180"},{default:s(({row:t})=>[o(V(new Date(t.created_at).toLocaleString()),1)]),_:1}),r(l(S),{label:"Actions",width:"520",fixed:"right"},{default:s(({row:t})=>[r(l(p),{type:"primary",size:"small",text:"",onClick:x=>J(t)},{icon:s(()=>[r(l(E),{icon:"ep:calendar"})]),default:s(()=>[e[14]||(e[14]=o(" Extend "))]),_:2},1032,["onClick"]),r(l(p),{type:"info",size:"small",text:"",onClick:x=>K(t)},{icon:s(()=>[r(l(E),{icon:"ep:date"})]),default:s(()=>[e[15]||(e[15]=o(" Set Expiry "))]),_:2},1032,["onClick"]),r(l(p),{type:"warning",size:"small",text:"",onClick:x=>L(t)},{icon:s(()=>[r(l(E),{icon:"ep:refresh"})]),default:s(()=>[e[16]||(e[16]=o(" Clear Expiry "))]),_:2},1032,["onClick"]),r(l(p),{type:"danger",size:"small",text:"",onClick:x=>Q(t)},{icon:s(()=>[r(l(E),{icon:"ep:warning"})]),default:s(()=>[e[17]||(e[17]=o(" Set Expired "))]),_:2},1032,["onClick"]),r(l(p),{type:t.disabled?"success":"warning",size:"small",text:"",onClick:x=>Y(t)},{icon:s(()=>[r(l(E),{icon:t.disabled?"ep:check":"ep:close"},null,8,["icon"])]),default:s(()=>[o(" "+V(t.disabled?"Enable":"Disable"),1)]),_:2},1032,["type","onClick"]),r(l(p),{type:"danger",size:"small",onClick:x=>H(t)},{icon:s(()=>[r(l(E),{icon:"ep:delete"})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[c,U.value]]),r(l(M),{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),title:"Create New User",width:"500px"},{footer:s(()=>[r(l(p),{onClick:e[4]||(e[4]=t=>w.value=!1)},{default:s(()=>e[20]||(e[20]=[o("Cancel")])),_:1}),r(l(p),{type:"primary",onClick:G},{default:s(()=>e[21]||(e[21]=[o("Create")])),_:1})]),default:s(()=>[r(l(I),{model:n,"label-width":"120px"},{default:s(()=>[r(l(T),{label:"Username"},{default:s(()=>[r(l(B),{modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=t=>n.username=t),placeholder:"Username"},null,8,["modelValue"])]),_:1}),r(l(T),{label:"Password"},{default:s(()=>[r(l(B),{modelValue:n.password,"onUpdate:modelValue":e[2]||(e[2]=t=>n.password=t),type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"])]),_:1}),r(l(T),{label:"Duration (Days)"},{default:s(()=>[r(l(B),{modelValue:n.duration_days,"onUpdate:modelValue":e[3]||(e[3]=t=>n.duration_days=t),modelModifiers:{number:!0},type:"number",placeholder:"30 (0 for unlimited)",style:{width:"100%"}},{append:s(()=>e[18]||(e[18]=[o("days")])),_:1},8,["modelValue"]),e[19]||(e[19]=j("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," Enter number of days (0 = unlimited) ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(l(M),{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=t=>b.value=t),title:"Extend Subscription",width:"400px"},{footer:s(()=>[r(l(p),{onClick:e[7]||(e[7]=t=>b.value=!1)},{default:s(()=>e[22]||(e[22]=[o("Cancel")])),_:1}),r(l(p),{type:"primary",onClick:X},{default:s(()=>e[23]||(e[23]=[o("Extend")])),_:1})]),default:s(()=>[r(l(I),{model:y,"label-width":"120px"},{default:s(()=>[r(l(T),{label:"Days to Extend"},{default:s(()=>[r(l(B),{modelValue:y.days,"onUpdate:modelValue":e[6]||(e[6]=t=>y.days=t),modelModifiers:{number:!0},type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(l(M),{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=t=>g.value=t),title:"Set Expiry",width:"450px"},{footer:s(()=>[r(l(p),{onClick:e[10]||(e[10]=t=>g.value=!1)},{default:s(()=>e[25]||(e[25]=[o("Cancel")])),_:1}),r(l(p),{type:"warning",onClick:e[11]||(e[11]=t=>f.value&&L(f.value,!0))},{default:s(()=>e[26]||(e[26]=[o(" Clear Expiry ")])),_:1}),r(l(p),{type:"primary",onClick:W},{default:s(()=>e[27]||(e[27]=[o("Save")])),_:1})]),default:s(()=>[r(l(I),{model:D,"label-width":"140px"},{default:s(()=>[r(l(T),{label:"Expires At"},{default:s(()=>[r(l(ce),{modelValue:D.expiresAt,"onUpdate:modelValue":e[9]||(e[9]=t=>D.expiresAt=t),type:"datetime",placeholder:"Select expiry date/time",style:{width:"100%"}},null,8,["modelValue"]),e[24]||(e[24]=j("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," Choose a past date/time to mark user as expired. ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}});export{Te as default};
